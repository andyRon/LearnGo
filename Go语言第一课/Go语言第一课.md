Goè¯­è¨€ç¬¬ä¸€è¯¾
---

[Go è¯­è¨€ç¬¬ä¸€è¯¾](https://time.geekbang.org/column/intro/100093501)



å®˜æ–¹ç½‘ç«™ï¼šhttps://golang.google.cn/ or https://go.dev/



## 0 è¿™æ ·å…¥é—¨Goï¼Œæ‰èƒ½å°‘èµ°å¼¯è·¯



### å…¥å‘Goçš„ä¸‰å¤§ç†ç”±



#### 1 å¯¹åˆå­¦è€…è¶³å¤Ÿå‹å–„ï¼Œèƒ½å¤Ÿå¿«é€Ÿä¸Šæ‰‹



#### 2 ç”Ÿäº§åŠ›ä¸æ€§èƒ½çš„æœ€ä½³ç»“åˆ

Goå·²ç»æˆä¸ºäº†äº‘åŸºç¡€æ¶æ„è¯­è¨€ï¼Œå®ƒåœ¨**äº‘åŸç”ŸåŸºç¡€è®¾æ–½ã€ä¸­é—´ä»¶ä¸äº‘æœåŠ¡**é¢†åŸŸå¤§æ”¾å¼‚å½©ã€‚åŒæ—¶ï¼ŒGOåœ¨**DevOps/SREã€åŒºå—é“¾ã€å‘½ä»¤è¡Œäº¤äº’ç¨‹åºï¼ˆCLIï¼‰ã€WebæœåŠ¡ï¼Œè¿˜æœ‰æ•°æ®å¤„ç†**ç­‰æ–¹é¢ä¹Ÿæœ‰å¤§é‡æ‹¥è¶¸ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥çœ‹åˆ°Goåœ¨**å¾®æ§åˆ¶å™¨ã€æœºå™¨äººã€æ¸¸æˆé¢†åŸŸ**ä¹Ÿæœ‰å¹¿æ³›åº”ç”¨ã€‚



#### 3 å¿«ä¹åˆæœ‰â€œé’±æ™¯â€

ç®€å•çš„è¯­æ³•ã€å¾—å¿ƒåº”æ‰‹çš„å·¥å…·é“¾ã€ä¸°å¯Œå’Œå¥å£®çš„æ ‡å‡†åº“ï¼Œè¿˜æœ‰ç”Ÿäº§åŠ›ä¸æ€§èƒ½çš„å®Œç¾ç»“åˆã€å…é™¤å†…å­˜ç®¡ç†çš„å¿ƒæ™ºè´Ÿæ‹…ï¼Œå¯¹å¹¶å‘è®¾è®¡çš„åŸç”Ÿæ”¯æŒ



# å‰ç½®ç¯‡ï¼šå¿ƒå®šä¹‹æ—…

## 01 å‰ä¸–ä»Šç”Ÿï¼šGoçš„å†å²å’Œç°çŠ¶

äº†è§£ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„å†å²å’Œç°çŠ¶ï¼Œä»¥åŠæœªæ¥çš„èµ°å‘ï¼Œå¯ä»¥å»ºç«‹èµ·**å­¦ä¹ çš„â€œå®‰å…¨æ„Ÿâ€**ï¼Œç›¸ä¿¡å®ƒèƒ½å¤Ÿç»™ä½ å¸¦æ¥è¶³å¤Ÿçš„ä»·å€¼å’Œæ”¶ç›Šï¼Œæ›´åŠ åšå®šåœ°å­¦ä¹ ä¸‹å»

ã€‚

### è¯ç”Ÿ

Goè¯­è¨€çš„åˆ›å§‹äººæœ‰ä¸‰ä½ï¼š

- å›¾çµå¥–è·å¾—è€…ã€Cè¯­æ³•è”åˆå‘æ˜äººã€Unixä¹‹çˆ¶è‚¯Â·æ±¤æ™®æ£®ï¼ˆKen Thompsonï¼‰
- Plan 9æ“ä½œç³»ç»Ÿé¢†å¯¼è€…ã€UTF-8ç¼–ç çš„æœ€åˆè®¾è®¡è€…ç½—ä¼¯Â·æ´¾å…‹ï¼ˆRob Pikeï¼‰
- Javaçš„HotSpotè™šæ‹Ÿæœºå’ŒChromeæµè§ˆå™¨çš„JavaScript V8å¼•æ“çš„è®¾è®¡è€…ä¹‹ä¸€ç½—ä¼¯ç‰¹Â·æ ¼ç‘å²è«ï¼ˆRobert Griesemerï¼‰ã€‚



- 2007å¹´9æœˆ20æ—¥ è®¨è®º

ä¸ä¾¿ï¼šC++çš„å·¨å¤§å¤æ‚æ€§ã€ç¼–è¯‘æ„å»ºé€Ÿåº¦æ…¢ä»¥åŠåœ¨ç¼–å†™æœåŠ¡ç«¯ç¨‹åºæ—¶å¯¹å¹¶å‘æ”¯æŒçš„ä¸è¶³

æ€è·¯ï¼šåœ¨Cè¯­è¨€çš„åŸºç¡€ä¸Šï¼Œä¿®æ­£ä¸€äº›æ˜æ˜¾çš„ç¼ºé™·ï¼Œåˆ é™¤ä¸€äº›è¢«è¯Ÿç—…è¾ƒå¤šçš„ç‰¹æ€§ï¼Œå¢åŠ ä¸€äº›ç¼ºå¤±çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼Œä½¿ç”¨importæ›¿ä»£includeã€å»æ‰å®ã€å¢åŠ åƒåœ¾å›æ”¶ã€æ”¯æŒæ¥å£ç­‰ã€‚

9æœˆ25æ—¥ï¼Œç½—ä¼¯Â·æ´¾å…‹ å‘½åä¸ºâ€œgoâ€ã€‚

â€œGolangâ€ä»…åº”ç”¨äºå‘½åGoè¯­è¨€å®˜æ–¹ç½‘ç«™ã€‚

### ä»â€œä¸‰äººè¡Œâ€åˆ°â€œä¼—äººæ‹¾æŸ´â€

- 2008å¹´åˆï¼Œè‚¯Â·æ±¤æ™®æ£®å®ç°äº†ç¬¬ä¸€ç‰ˆGoç¼–è¯‘å™¨ï¼Œç”¨äºéªŒè¯ä¹‹å‰çš„è®¾è®¡ã€‚è¿™ä¸ªç¼–è¯‘å™¨å…ˆå°†Goä»£ç è½¬æ¢ä¸ºCä»£ç ï¼Œå†ç”±Cç¼–è¯‘å™¨ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ã€‚

- 2008å¹´å¹´ä¸­ï¼ŒGoçš„ç¬¬ä¸€ç‰ˆè®¾è®¡å°±åŸºæœ¬ç»“æŸäº†ã€‚ä¼Šæ©Â·æ³°å‹’ï¼ˆIan Lance Taylorï¼‰ä¸ºGoè¯­è¨€å®ç°äº†ä¸€ä¸ªgccçš„å‰ç«¯ï¼Œè¿™ä¹Ÿæ˜¯Goè¯­è¨€çš„ç¬¬äºŒä¸ªç¼–è¯‘å™¨ã€‚

ä¹‹åä»–æˆä¸ºäº†Goè¯­è¨€ï¼Œä»¥åŠå…¶å·¥å…·è®¾è®¡å’Œå®ç°çš„æ ¸å¿ƒäººç‰©ä¹‹ä¸€ã€‚

- 2008å¹´ï¼Œç½—æ–¯Â·è€ƒå…‹æ–¯ï¼ˆRuss Coxï¼‰åˆ©ç”¨å‡½æ•°ç±»å‹æ˜¯â€œä¸€ç­‰å…¬æ°‘â€ï¼Œè€Œä¸”å®ƒä¹Ÿå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„æ–¹æ³•è¿™ä¸ªç‰¹æ€§å·§å¦™è®¾è®¡å‡ºäº†httpåŒ…çš„HandlerFuncç±»å‹ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬é€šè¿‡æ˜¾å¼è½¬å‹å°±å¯ä»¥è®©ä¸€ä¸ªæ™®é€šå‡½æ•°æˆä¸ºæ»¡è¶³http.Handleræ¥å£çš„ç±»å‹äº†ã€‚

- 2009å¹´10æœˆ30æ—¥ï¼ŒGoè¯­è¨€ç¬¬ä¸€æ¬¡å…¬ä¹‹äºä¼—ã€‚
- 2009å¹´11æœˆ10æ—¥ï¼Œè°·æ­Œå®˜æ–¹å®£å¸ƒGoè¯­è¨€é¡¹ç›®å¼€æºï¼Œä¹‹åè¿™ä¸€å¤©ä¹Ÿè¢«Goå®˜æ–¹ç¡®å®šä¸ºGoè¯­è¨€çš„è¯ç”Ÿæ—¥ã€‚

â€œå‰ç¥¥ç‰©â€ï¼Œæ˜¯ä¸€åªç”±ç½—ä¼¯Â·æ´¾å…‹å¤«äººèŠ®å¦®Â·å¼—ä¼¦å¥‡ï¼ˆRenee Frenchï¼‰è®¾è®¡çš„åœ°é¼ ï¼Œä»æ­¤åœ°é¼ ï¼ˆgopherï¼‰ä¹Ÿå°±æˆä¸ºäº†ä¸–ç•Œå„åœ°Goç¨‹åºå‘˜çš„è±¡å¾ï¼ŒGoç¨‹åºå‘˜ä¹Ÿè¢«æ˜µç§°ä¸ºGopherã€‚

- 2012å¹´3æœˆ28æ—¥ï¼ŒGo 1.0ç‰ˆæœ¬æ­£å¼å‘å¸ƒ



![](images/image-20240701100957741.png)

### Goæ˜¯å¦å€¼å¾—æˆ‘ä»¬å­¦ä¹ ï¼Ÿ

ç°ä»£äº‘è®¡ç®—åŸºç¡€è®¾æ–½è½¯ä»¶çš„å¤§éƒ¨åˆ†æµè¡Œå’Œå¯é çš„ä½œå“ï¼Œéƒ½æ˜¯ç”¨Goç¼–å†™çš„ï¼Œæ¯”å¦‚ï¼šDockerã€Kubernetesã€Prometheusã€Ethereumï¼ˆä»¥å¤ªåŠï¼‰ã€Istioã€CockroachDBã€InfluxDBã€Terraformã€Etcdã€Consulç­‰ç­‰ã€‚

## 02 Goè¯­è¨€çš„è®¾è®¡å“²å­¦

ç¼–ç¨‹è¯­è¨€çš„è®¾è®¡å“²å­¦ï¼Œå°±æ˜¯æŒ‡å†³å®šè¿™é—¨**è¯­è¨€æ¼”åŒ–è¿›ç¨‹çš„é«˜çº§åŸåˆ™å’Œä¾æ®**ã€‚

Goè¯­è¨€çš„è®¾è®¡å“²å­¦æ€»ç»“ä¸ºäº”ç‚¹ï¼šç®€å•ã€æ˜¾å¼ã€ç»„åˆã€å¹¶å‘å’Œé¢å‘å·¥ç¨‹ã€‚

### ç®€å•

> â€œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€åˆ›å»ºä¼Šå§‹éƒ½è‡´åŠ›äºæˆä¸ºä¸€é—¨ç®€å•çš„è¯­è¨€ï¼Œä½†æœ€ç»ˆéƒ½åªæ˜¯æ»¡è¶³äºåšä¸€ä¸ªå¼ºå¤§çš„ç¼–ç¨‹è¯­è¨€â€ã€‚

Goè¯­è¨€çš„è®¾è®¡è€…ä»¬åœ¨è¯­è¨€è®¾è®¡ä¹‹åˆï¼Œå°±æ‹’ç»äº†èµ°è¯­è¨€ç‰¹æ€§èåˆçš„é“è·¯ï¼Œé€‰æ‹©äº†â€œåšå‡æ³•â€å¹¶è‡´åŠ›äºæ‰“é€ ä¸€é—¨ç®€å•çš„ç¼–ç¨‹è¯­è¨€ã€‚

å…¶å®ï¼ŒGoè¯­è¨€ä¹Ÿæ²¡å®ƒçœ‹èµ·æ¥é‚£ä¹ˆç®€å•ï¼Œè‡ªèº«å®ç°èµ·æ¥å¹¶ä¸å®¹æ˜“ï¼Œä½†è¿™äº›**å¤æ‚æ€§è¢«Goè¯­è¨€çš„è®¾è®¡è€…ä»¬â€œéšè—â€äº†**ï¼Œæ‰€ä»¥Goè¯­æ³•å±‚é¢ä¸Šå‘ˆç°äº†è¿™æ ·çš„çŠ¶æ€ï¼š

- ä»…æœ‰25ä¸ªå…³é”®å­—ï¼Œä¸»æµç¼–ç¨‹è¯­è¨€æœ€å°‘ï¼›
- å†…ç½®åƒåœ¾æ”¶é›†ï¼Œé™ä½å¼€å‘äººå‘˜å†…å­˜ç®¡ç†çš„å¿ƒæ™ºè´Ÿæ‹…ï¼›
- é¦–å­—æ¯å¤§å°å†™å†³å®šå¯è§æ€§ï¼Œæ— éœ€é€šè¿‡é¢å¤–å…³é”®å­—ä¿®é¥°ï¼›
- å˜é‡åˆå§‹ä¸ºç±»å‹é›¶å€¼ï¼Œé¿å…ä»¥éšæœºå€¼ä½œä¸ºåˆå€¼çš„é—®é¢˜ï¼›
- å†…ç½®æ•°ç»„è¾¹ç•Œæ£€æŸ¥ï¼Œæå¤§å‡å°‘è¶Šç•Œè®¿é—®å¸¦æ¥çš„å®‰å…¨éšæ‚£ï¼›

- å†…ç½®å¹¶å‘æ”¯æŒï¼Œç®€åŒ–å¹¶å‘ç¨‹åºè®¾è®¡ï¼›
- å†…ç½®æ¥å£ç±»å‹ï¼Œä¸ºç»„åˆçš„è®¾è®¡å“²å­¦å¥ å®šåŸºç¡€ï¼›
- åŸç”Ÿæä¾›å®Œå–„çš„å·¥å…·é“¾ï¼Œå¼€ç®±å³ç”¨ï¼›
- â€¦ â€¦

> ä»»ä½•çš„è®¾è®¡éƒ½å­˜åœ¨ç€æƒè¡¡ä¸æŠ˜ä¸­

> ç®€å•æ„å‘³ç€å¯ä»¥ä½¿ç”¨**æ›´å°‘çš„ä»£ç **å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼›ç®€å•æ„å‘³ç€ä»£ç å…·æœ‰æ›´å¥½çš„**å¯è¯»æ€§**ï¼Œè€Œå¯è¯»æ€§å¥½çš„ä»£ç é€šå¸¸æ„å‘³ç€æ›´å¥½çš„**å¯ç»´æŠ¤æ€§ä»¥åŠå¯é æ€§**ã€‚

### æ˜¾å¼

Goä¸å…è®¸ä¸åŒç±»å‹çš„æ•´å‹å˜é‡è¿›è¡Œæ··åˆè®¡ç®—ï¼Œå®ƒåŒæ ·ä¹Ÿä¸ä¼šå¯¹å…¶è¿›è¡Œéšå¼çš„è‡ªåŠ¨è½¬æ¢ã€‚

Goå¸Œæœ›å¼€å‘äººå‘˜æ˜ç¡®çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œè¿™ä¸Cè¯­è¨€çš„â€œä¿¡ä»»ç¨‹åºå‘˜â€åŸåˆ™å®Œå…¨ä¸åŒã€‚

é™¤æ­¤ä¹‹å¤–ï¼ŒGoè®¾è®¡è€…æ‰€å´‡å°šçš„æ˜¾å¼å“²å­¦è¿˜ç›´æ¥å†³å®šäº†Goè¯­è¨€é”™è¯¯å¤„ç†çš„å½¢æ€ï¼šGoè¯­è¨€é‡‡ç”¨äº†æ˜¾å¼çš„åŸºäºå€¼æ¯”è¾ƒçš„é”™è¯¯å¤„ç†æ–¹æ¡ˆï¼Œå‡½æ•°/æ–¹æ³•ä¸­çš„é”™è¯¯éƒ½ä¼šé€šè¿‡returnè¯­å¥æ˜¾å¼åœ°è¿”å›ï¼Œå¹¶ä¸”é€šå¸¸è°ƒç”¨è€…ä¸èƒ½å¿½ç•¥å¯¹è¿”å›çš„é”™è¯¯çš„å¤„ç†ã€‚

### ç»„åˆ

Goè¯­è¨€ä¸åƒC++ã€Javaç­‰ä¸»æµé¢å‘å¯¹è±¡è¯­è¨€ï¼Œåœ¨Goä¸­æ˜¯æ‰¾ä¸åˆ°ç»å…¸çš„é¢å‘å¯¹è±¡è¯­æ³•å…ƒç´ ã€ç±»å‹ä½“ç³»å’Œç»§æ‰¿æœºåˆ¶çš„ï¼ŒGoæ¨å´‡çš„æ˜¯ç»„åˆçš„è®¾è®¡å“²å­¦ã€‚

åœ¨Goè¯­è¨€è®¾è®¡å±‚é¢ï¼ŒGoè®¾è®¡è€…ä¸ºå¼€å‘è€…ä»¬æä¾›äº†**æ­£äº¤çš„è¯­æ³•å…ƒç´ **ï¼Œä»¥ä¾›åç»­ç»„åˆä½¿ç”¨ï¼ŒåŒ…æ‹¬ï¼š

- Goè¯­è¨€æ— ç±»å‹å±‚æ¬¡ä½“ç³»ï¼Œå„ç±»å‹ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰å­ç±»å‹çš„æ¦‚å¿µï¼›
- æ¯ä¸ªç±»å‹éƒ½å¯ä»¥æœ‰è‡ªå·±çš„æ–¹æ³•é›†åˆï¼Œç±»å‹å®šä¹‰ä¸æ–¹æ³•å®ç°æ˜¯**æ­£äº¤ç‹¬ç«‹**çš„ï¼›
- å®ç°æŸä¸ªæ¥å£æ—¶ï¼Œæ— éœ€åƒJavaé‚£æ ·é‡‡ç”¨ç‰¹å®šå…³é”®å­—ä¿®é¥°ï¼›
- åŒ…ä¹‹é—´æ˜¯ç›¸å¯¹ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰å­åŒ…çš„æ¦‚å¿µã€‚

Goè¯­è¨€ä¸ºæ”¯æ’‘ç»„åˆçš„è®¾è®¡æä¾›äº†==ç±»å‹åµŒå…¥ï¼ˆType Embeddingï¼‰==ã€‚é€šè¿‡ç±»å‹åµŒå…¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†å·²ç»å®ç°çš„åŠŸèƒ½åµŒå…¥åˆ°æ–°ç±»å‹ä¸­ï¼Œä»¥å¿«é€Ÿæ»¡è¶³æ–°ç±»å‹çš„åŠŸèƒ½éœ€æ±‚ï¼Œè¿™ç§æ–¹å¼æœ‰äº›ç±»ä¼¼ç»å…¸é¢å‘å¯¹è±¡è¯­è¨€ä¸­çš„â€œç»§æ‰¿â€æœºåˆ¶ï¼Œä½†åœ¨åŸç†ä¸Šå´ä¸é¢å‘å¯¹è±¡ä¸­çš„ç»§æ‰¿å®Œå…¨ä¸åŒï¼Œè¿™æ˜¯ä¸€ç§Goè®¾è®¡è€…ä»¬ç²¾å¿ƒè®¾è®¡çš„â€œè¯­æ³•ç³–â€ã€‚

è¢«åµŒå…¥çš„ç±»å‹å’Œæ–°ç±»å‹ä¸¤è€…ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œç”šè‡³ç›¸äº’å®Œå…¨ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼Œæ›´æ²¡æœ‰ç»å…¸é¢å‘å¯¹è±¡è¯­è¨€ä¸­çš„é‚£ç§çˆ¶ç±»ã€å­ç±»çš„å…³ç³»ï¼Œä»¥åŠ==å‘ä¸Šã€å‘ä¸‹è½¬å‹ï¼ˆType Castingï¼‰==ã€‚é€šè¿‡æ–°ç±»å‹å®ä¾‹è°ƒç”¨æ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„åŒ¹é…ä¸»è¦å–å†³äº**æ–¹æ³•åå­—**ï¼Œè€Œä¸æ˜¯ç±»å‹ã€‚è¿™ç§ç»„åˆæ–¹å¼ï¼Œæˆ‘ç§°ä¹‹ä¸º==å‚ç›´ç»„åˆ==ï¼Œå³é€šè¿‡ç±»å‹åµŒå…¥ï¼Œå¿«é€Ÿè®©ä¸€ä¸ªæ–°ç±»å‹â€œå¤ç”¨â€å…¶ä»–ç±»å‹å·²ç»å®ç°çš„èƒ½åŠ›ï¼Œå®ç°åŠŸèƒ½çš„==å‚ç›´æ‰©å±•==ã€‚

```go
// $GOROOT/src/sync/pool.go
type poolLocal struct {
    private interface{}   
    shared  []interface{}
    Mutex               
    pad     [128]byte  
}
```

åœ¨poolLocalè¿™ä¸ªç»“æ„ä½“ç±»å‹ä¸­åµŒå…¥äº†ç±»å‹Mutexï¼Œè¿™å°±ä½¿å¾—poolLocalè¿™ä¸ªç±»å‹å…·æœ‰äº†äº’æ–¥åŒæ­¥çš„èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡poolLocalç±»å‹çš„å˜é‡ï¼Œç›´æ¥è°ƒç”¨Mutexç±»å‹çš„æ–¹æ³•Lockæˆ–Unlockã€‚

```go
// $GOROOT/src/io/io.go
type ReadWriter interface {
    Reader
    Writer
}
```

é€šè¿‡åµŒå…¥æ¥å£ç±»å‹çš„æ–¹å¼æ¥å®ç°æ¥å£è¡Œä¸ºçš„èšåˆï¼Œç»„æˆ==å¤§æ¥å£==ï¼Œè¿™ç§æ–¹å¼åœ¨æ ‡å‡†åº“ä¸­å°¤ä¸ºå¸¸ç”¨ï¼Œå¹¶ä¸”å·²ç»æˆä¸ºäº†Goè¯­è¨€çš„ä¸€ç§æƒ¯ç”¨æ³•ã€‚

å‚ç›´ç»„åˆæœ¬è´¨ä¸Šæ˜¯ä¸€ç§â€œ==èƒ½åŠ›ç»§æ‰¿==â€ï¼Œé‡‡ç”¨åµŒå…¥æ–¹å¼å®šä¹‰çš„æ–°ç±»å‹ç»§æ‰¿äº†åµŒå…¥ç±»å‹çš„èƒ½åŠ›ã€‚Goè¿˜æœ‰ä¸€ç§å¸¸è§çš„ç»„åˆæ–¹å¼ï¼Œå«==æ°´å¹³ç»„åˆ==ã€‚å’Œå‚ç›´ç»„åˆçš„èƒ½åŠ›ç»§æ‰¿ä¸åŒï¼Œæ°´å¹³ç»„åˆæ˜¯ä¸€ç§==èƒ½åŠ›å§”æ‰˜ï¼ˆDelegateï¼‰==ï¼Œé€šå¸¸ä½¿ç”¨æ¥å£ç±»å‹æ¥å®ç°æ°´å¹³ç»„åˆã€‚

Goè¯­è¨€ä¸­çš„æ¥å£åªæ˜¯**æ–¹æ³•é›†åˆ**ï¼Œå¹¶ä¸”å®ƒä¸å®ç°è€…ä¹‹é—´çš„å…³ç³»æ— éœ€é€šè¿‡æ˜¾å¼å…³é”®å­—ä¿®é¥°ï¼Œå®ƒè®©ç¨‹åºå†…éƒ¨å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆé™è‡³æœ€ä½ï¼ŒåŒæ—¶å®ƒä¹Ÿæ˜¯è¿æ¥ç¨‹åºå„ä¸ªéƒ¨åˆ†ä¹‹é—´â€œçº½å¸¦â€ã€‚

æ°´å¹³ç»„åˆçš„æ¨¡å¼1ï¸âƒ£ï¼Œé€šè¿‡æ¥å—æ¥å£ç±»å‹å‚æ•°çš„æ™®é€šå‡½æ•°è¿›è¡Œç»„åˆï¼š

```go
// $GOROOT/src/io/ioutil/ioutil.go
func ReadAll(r io.Reader)([]byte, error)

// $GOROOT/src/io/io.go
func Copy(dst Writer, src Reader)(written int64, err error)
```

å‡½æ•°ReadAllé€šè¿‡io.Readerè¿™ä¸ªæ¥å£ï¼Œå°†io.Readerçš„å®ç°ä¸ReadAllæ‰€åœ¨çš„åŒ…ä½è€¦åˆåœ°æ°´å¹³ç»„åˆåœ¨ä¸€èµ·äº†ï¼Œä»è€Œè¾¾åˆ°ä»ä»»æ„å®ç°io.Readerçš„æ•°æ®æºè¯»å–æ‰€æœ‰æ•°æ®çš„ç›®çš„ã€‚ç±»ä¼¼çš„æ°´å¹³ç»„åˆâ€œæ¨¡å¼â€è¿˜æœ‰ç‚¹ç¼€å™¨ã€ä¸­é—´ä»¶ç­‰ã€‚

2ï¸âƒ£å°†Goè¯­è¨€å†…ç½®çš„å¹¶å‘èƒ½åŠ›è¿›è¡Œçµæ´»ç»„åˆä»¥å®ç°ï¼Œæ¯”å¦‚ï¼Œé€šè¿‡goroutine+channelçš„ç»„åˆï¼Œå¯ä»¥å®ç°ç±»ä¼¼Unix Pipeçš„èƒ½åŠ›ã€‚

æ€»ä¹‹ï¼Œç»„åˆåŸåˆ™çš„åº”ç”¨å®è´¨ä¸Šæ˜¯å¡‘é€ äº†Goç¨‹åºçš„éª¨æ¶ç»“æ„ã€‚ç±»å‹åµŒå…¥ä¸ºç±»å‹æä¾›äº†å‚ç›´æ‰©å±•èƒ½åŠ›ï¼Œè€Œæ¥å£æ˜¯æ°´å¹³ç»„åˆçš„å…³é”®ã€‚

### å¹¶å‘

> â€œå¹¶å‘â€å‡ºç°çš„èƒŒæ™¯
>
> CPUéƒ½æ˜¯é æé«˜ä¸»é¢‘æ¥æ”¹è¿›æ€§èƒ½çš„ï¼Œä½†æ˜¯ç°åœ¨è¿™ä¸ªåšæ³•å·²ç»é‡åˆ°äº†ç“¶é¢ˆã€‚ä¸»é¢‘æé«˜å¯¼è‡´CPUçš„åŠŸè€—å’Œå‘çƒ­é‡å‰§å¢ï¼Œåè¿‡æ¥åˆ¶çº¦äº†CPUæ€§èƒ½çš„è¿›ä¸€æ­¥æé«˜ã€‚2007å¹´å¼€å§‹ï¼Œå¤„ç†å™¨å‚å•†çš„ç«äº‰ç„¦ç‚¹ä»ä¸»é¢‘è½¬å‘äº†å¤šæ ¸ã€‚

Goæ”¾å¼ƒäº†ä¼ ç»Ÿçš„åŸºäº**æ“ä½œç³»ç»Ÿçº¿ç¨‹**çš„å¹¶å‘æ¨¡å‹ï¼Œè€Œé‡‡ç”¨äº†**ç”¨æˆ·å±‚è½»é‡çº§çº¿ç¨‹**ï¼ŒGoå°†ä¹‹ç§°ä¸º==goroutine==ã€‚

goroutineå ç”¨çš„èµ„æºéå¸¸å°ï¼ŒGoè¿è¡Œæ—¶é»˜è®¤ä¸ºæ¯ä¸ªgoroutineåˆ†é…çš„æ ˆç©ºé—´ä»…==2KB==ã€‚goroutineè°ƒåº¦çš„åˆ‡æ¢ä¹Ÿä¸ç”¨é™·å…¥ï¼ˆtrapï¼‰æ“ä½œç³»ç»Ÿå†…æ ¸å±‚å®Œæˆï¼Œä»£ä»·å¾ˆä½ã€‚å› æ­¤ï¼Œä¸€ä¸ªGoç¨‹åºä¸­å¯ä»¥åˆ›å»º**æˆåƒä¸Šä¸‡**ä¸ªå¹¶å‘çš„goroutineã€‚è€Œä¸”ï¼Œæ‰€æœ‰çš„Goä»£ç éƒ½åœ¨goroutineä¸­æ‰§è¡Œï¼Œå“ªæ€•æ˜¯goè¿è¡Œæ—¶çš„ä»£ç ä¹Ÿä¸ä¾‹å¤–ã€‚

Goè¿˜åœ¨è¯­è¨€å±‚é¢å†…ç½®äº†è¾…åŠ©å¹¶å‘è®¾è®¡çš„åŸè¯­ï¼š`channel`å’Œ`select`ã€‚å¼€å‘è€…å¯ä»¥é€šè¿‡è¯­è¨€å†…ç½®çš„channel**ä¼ é€’æ¶ˆæ¯æˆ–å®ç°åŒæ­¥**ï¼Œå¹¶é€šè¿‡selectå®ç°**å¤šè·¯channelçš„å¹¶å‘æ§åˆ¶**ã€‚

å¹¶å‘ä¸ç»„åˆçš„å“²å­¦æ˜¯ä¸€è„‰ç›¸æ‰¿çš„ï¼Œ**å¹¶å‘æ˜¯ä¸€ä¸ªæ›´å¤§çš„ç»„åˆçš„æ¦‚å¿µ**ï¼Œå®ƒåœ¨ç¨‹åºè®¾è®¡çš„å…¨å±€å±‚é¢å¯¹ç¨‹åºè¿›è¡Œæ‹†è§£ç»„åˆï¼Œå†æ˜ å°„åˆ°ç¨‹åºæ‰§è¡Œå±‚é¢ä¸Šï¼šgoroutineså„è‡ªæ‰§è¡Œç‰¹å®šçš„å·¥ä½œï¼Œé€šè¿‡channel+selectå°†goroutinesç»„åˆè¿æ¥èµ·æ¥

### é¢å‘å·¥ç¨‹

Goè¯­è¨€è®¾è®¡çš„åˆè¡·ï¼Œå°±æ˜¯é¢å‘è§£å†³çœŸå®ä¸–ç•Œä¸­Googleå†…éƒ¨å¤§è§„æ¨¡è½¯ä»¶å¼€å‘å­˜åœ¨çš„å„ç§é—®é¢˜ï¼Œä¸ºè¿™äº›é—®é¢˜æä¾›ç­”æ¡ˆï¼Œè¿™äº›é—®é¢˜åŒ…æ‹¬ï¼š**ç¨‹åºæ„å»ºæ…¢ã€ä¾èµ–ç®¡ç†å¤±æ§ã€ä»£ç éš¾äºç†è§£ã€è·¨è¯­è¨€æ„å»ºéš¾**ç­‰ã€‚

Goåœ¨è¯­æ³•è®¾è®¡ç»†èŠ‚ä¸Šåšäº†ç²¾å¿ƒçš„æ‰“ç£¨ã€‚æ¯”å¦‚ï¼š

- é‡æ–°è®¾è®¡ç¼–è¯‘å•å…ƒå’Œç›®æ ‡æ–‡ä»¶æ ¼å¼ï¼Œå®ç°Goæºç å¿«é€Ÿæ„å»ºï¼Œè®©å¤§å·¥ç¨‹çš„æ„å»ºæ—¶é—´ç¼©çŸ­åˆ°ç±»ä¼¼åŠ¨æ€è¯­è¨€çš„äº¤äº’å¼è§£é‡Šçš„ç¼–è¯‘é€Ÿåº¦ï¼›
- å¦‚æœæºæ–‡ä»¶å¯¼å…¥å®ƒä¸ä½¿ç”¨çš„åŒ…ï¼Œåˆ™ç¨‹åºå°†æ— æ³•ç¼–è¯‘ã€‚è¿™å¯ä»¥å……åˆ†ä¿è¯ä»»ä½•Goç¨‹åºçš„**ä¾èµ–æ ‘æ˜¯ç²¾ç¡®çš„**ã€‚è¿™ä¹Ÿå¯ä»¥ä¿è¯åœ¨æ„å»ºç¨‹åºæ—¶ä¸ä¼šç¼–è¯‘é¢å¤–çš„ä»£ç ï¼Œä»è€Œæœ€å¤§é™åº¦åœ°ç¼©çŸ­ç¼–è¯‘æ—¶é—´ï¼›
- **å»é™¤åŒ…çš„å¾ªç¯ä¾èµ–**ï¼Œå¾ªç¯ä¾èµ–ä¼šåœ¨å¤§è§„æ¨¡çš„ä»£ç ä¸­å¼•å‘é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬è¦æ±‚ç¼–è¯‘å™¨åŒæ—¶å¤„ç†æ›´å¤§çš„æºæ–‡ä»¶é›†ï¼Œè¿™ä¼šå‡æ…¢å¢é‡æ„å»ºï¼›
- **åŒ…è·¯å¾„æ˜¯å”¯ä¸€çš„ï¼Œè€ŒåŒ…åä¸å¿…å”¯ä¸€çš„**ã€‚å¯¼å…¥è·¯å¾„å¿…é¡»å”¯ä¸€æ ‡è¯†è¦å¯¼å…¥çš„åŒ…ï¼Œè€Œåç§°åªæ˜¯åŒ…çš„ä½¿ç”¨è€…å¦‚ä½•å¼•ç”¨å…¶å†…å®¹çš„çº¦å®šã€‚â€œåŒ…åç§°ä¸å¿…æ˜¯å”¯ä¸€çš„â€è¿™ä¸ªçº¦å®šï¼Œå¤§å¤§é™ä½äº†å¼€å‘äººå‘˜ç»™åŒ…èµ·å”¯ä¸€åå­—çš„å¿ƒæ™ºè´Ÿæ‹…ï¼›ğŸ”–
- æ•…æ„**ä¸æ”¯æŒé»˜è®¤å‡½æ•°å‚æ•°**ã€‚å› ä¸ºåœ¨è§„æ¨¡å·¥ç¨‹ä¸­ï¼Œå¾ˆå¤šå¼€å‘è€…åˆ©ç”¨é»˜è®¤å‡½æ•°å‚æ•°æœºåˆ¶ï¼Œå‘å‡½æ•°æ·»åŠ è¿‡å¤šçš„å‚æ•°ä»¥å¼¥è¡¥å‡½æ•°APIçš„è®¾è®¡ç¼ºé™·ï¼Œè¿™ä¼šå¯¼è‡´å‡½æ•°æ‹¥æœ‰å¤ªå¤šçš„å‚æ•°ï¼Œé™ä½æ¸…æ™°åº¦å’Œå¯è¯»æ€§ï¼›
- å¢åŠ **ç±»å‹åˆ«åï¼ˆtype aliasï¼‰**ï¼Œæ”¯æŒå¤§è§„æ¨¡ä»£ç åº“çš„é‡æ„ã€‚

Go**æ ‡å‡†åº“åŠŸèƒ½ä¸°å¯Œ**ï¼Œå¤šæ•°åŠŸèƒ½ä¸éœ€è¦ä¾èµ–å¤–éƒ¨çš„ç¬¬ä¸‰æ–¹åŒ…æˆ–åº“ã€‚

Goè¯­è¨€å°±æä¾›äº†è¶³ä»¥è®©æ‰€æœ‰å…¶å®ƒä¸»æµè¯­è¨€å¼€å‘äººå‘˜ç¾¡æ…•çš„**å·¥å…·é“¾**ï¼Œæ¶µç›–äº†**ç¼–è¯‘æ„å»ºã€ä»£ç æ ¼å¼åŒ–ã€åŒ…ä¾èµ–ç®¡ç†ã€é™æ€ä»£ç æ£€æŸ¥ã€æµ‹è¯•ã€æ–‡æ¡£ç”Ÿæˆä¸æŸ¥çœ‹ã€æ€§èƒ½å‰–æã€è¯­è¨€æœåŠ¡å™¨ã€è¿è¡Œæ—¶ç¨‹åºè·Ÿè¸ª**ç­‰æ–¹æ–¹é¢é¢ã€‚å…¶ä¸­`gofmt`ç»Ÿä¸€äº†Goè¯­è¨€çš„ä»£ç é£æ ¼

Goåœ¨æ ‡å‡†åº“ä¸­æä¾›äº†å®˜æ–¹çš„**è¯æ³•åˆ†æå™¨ã€è¯­æ³•è§£æå™¨å’Œç±»å‹æ£€æŸ¥å™¨**ç›¸å…³åŒ…ï¼Œå¼€å‘è€…å¯ä»¥åŸºäºè¿™äº›åŒ…å¿«é€Ÿæ„å»ºå¹¶æ‰©å±•Goå·¥å…·é“¾ã€‚



### æ€è€ƒé¢˜

> è¿˜èƒ½ä¸¾å‡ºå“ªäº›ç¬¦åˆGoè¯­è¨€è®¾è®¡å“²å­¦çš„ä¾‹å­å—ï¼Ÿ



# å…¥é—¨ç¯‡ï¼šå‹¤åŠ ç»ƒæ‰‹

## 03 é…å¥½ç¯å¢ƒï¼šé€‰æ‹©ä¸€ç§æœ€é€‚åˆä½ çš„Goå®‰è£…æ–¹æ³•

### é€‰æ‹©Goç‰ˆæœ¬

Goè¯­è¨€çš„ç‰ˆæœ¬å‘å¸ƒç­–ç•¥:

- æ¯å¹´å‘å¸ƒä¸¤æ¬¡å¤§ç‰ˆæœ¬ï¼Œä¸€èˆ¬æ˜¯åœ¨äºŒæœˆä»½å’Œå…«æœˆä»½å‘å¸ƒ
- å¯¹æœ€æ–°çš„ä¸¤ä¸ªGoç¨³å®šå¤§ç‰ˆæœ¬æä¾›æ”¯æŒ

- æ”¯æŒçš„èŒƒå›´ä¸»è¦åŒ…æ‹¬**ä¿®å¤ç‰ˆæœ¬ä¸­å­˜åœ¨çš„é‡å¤§é—®é¢˜ã€æ–‡æ¡£å˜æ›´ä»¥åŠå®‰å…¨é—®é¢˜æ›´æ–°**ç­‰ã€‚

### å®‰è£…Go



### å®‰è£…å¤šä¸ªGoç‰ˆæœ¬ ğŸ”–



### é…ç½®Go

`go env`

![](images/image-20240701182610693.png)

`go help environment`



## 04 åˆçª¥é—¨å¾„ï¼šä¸€ä¸ªGoç¨‹åºçš„ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ

Goæºæ–‡ä»¶æ€»æ˜¯ç”¨å…¨å°å†™å­—æ¯å½¢å¼çš„çŸ­å°å•è¯å‘½åï¼Œå¹¶ä¸”ä»¥.goæ‰©å±•åç»“å°¾ã€‚å¤šä¸ªå•è¯å°±ç›´æ¥è¿æ¥èµ·æ¥ï¼Œä¸è¦ç”¨ä¸‹åˆ’çº¿è¿æ¥ï¼ˆä¸‹åˆ’çº¿åœ¨åœ¨Goæºæ–‡ä»¶å‘½åä¸­æœ‰ç‰¹æ®Šä½œç”¨ï¼‰ã€‚

```go
package main

import "fmt"

func main() {
    fmt.Println("hello, world")
} 
```



æ•´ä¸ªGoç¨‹åºä¸­ä»…å…è®¸å­˜åœ¨ä¸€ä¸ªåä¸ºmainçš„åŒ…ã€‚

`Gofmt`æ˜¯Goè¯­è¨€åœ¨è§£å†³è§„æ¨¡åŒ–ï¼ˆscaleï¼‰é—®é¢˜ä¸Šçš„ä¸€ä¸ªæœ€ä½³å®è·µã€‚

import â€œfmtâ€ ä¸€è¡Œä¸­â€œ`fmt`â€ä»£è¡¨çš„æ˜¯åŒ…çš„å¯¼å…¥è·¯å¾„ï¼ˆImportï¼‰ï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯æ ‡å‡†åº“ä¸‹çš„fmtç›®å½•ï¼Œæ•´ä¸ªimportå£°æ˜è¯­å¥çš„å«ä¹‰æ˜¯å¯¼å…¥æ ‡å‡†åº“fmtç›®å½•ä¸‹çš„åŒ…ï¼›`fmt.Println`å‡½æ•°è°ƒç”¨ä¸€è¡Œä¸­çš„â€œ`fmt`â€ä»£è¡¨çš„åˆ™æ˜¯åŒ…åã€‚ä¸¤è€…æ˜¯ä¸ä¸€æ ·çš„ã€‚

åœ¨Goè¯­è¨€ä¸­ï¼Œåªæœ‰é¦–å­—æ¯ä¸ºå¤§å†™çš„æ ‡è¯†ç¬¦æ‰æ˜¯å¯¼å‡ºçš„ï¼ˆExportedï¼‰ï¼Œæ‰èƒ½å¯¹åŒ…å¤–çš„ä»£ç å¯è§ã€‚

### Goè¯­è¨€ä¸­ç¨‹åºæ˜¯æ€ä¹ˆç¼–è¯‘çš„ï¼Ÿ

```shell
go build main.go
```

`go run`è¿™ç±»å‘½ä»¤æ›´å¤šç”¨äºå¼€å‘è°ƒè¯•é˜¶æ®µï¼ŒçœŸæ­£çš„äº¤ä»˜æˆæœè¿˜æ˜¯éœ€è¦ä½¿ç”¨go buildå‘½ä»¤æ„å»ºçš„

### å¤æ‚é¡¹ç›®ä¸‹Goç¨‹åºçš„ç¼–è¯‘æ˜¯æ€æ ·çš„

==Go module==æ„å»ºæ¨¡å¼æ˜¯åœ¨Go 1.11ç‰ˆæœ¬æ­£å¼å¼•å…¥çš„ï¼Œä¸ºçš„æ˜¯**å½»åº•è§£å†³Goé¡¹ç›®å¤æ‚ç‰ˆæœ¬ä¾èµ–çš„é—®é¢˜**ï¼Œåœ¨Go 1.16ç‰ˆæœ¬ä¸­ï¼ŒGo moduleå·²ç»æˆä¸ºäº†Goé»˜è®¤çš„**åŒ…ä¾èµ–ç®¡ç†æœºåˆ¶å’ŒGoæºç æ„å»ºæœºåˆ¶**ã€‚

`go mod init github.com/andyron/hellomodule`åˆ›å»º`go.mod`æ–‡ä»¶ï¼š

```
module github.com/andyron/hellomodule

go 1.22.1
```

ä¸€ä¸ªmoduleå°±æ˜¯ä¸€ä¸ªåŒ…çš„é›†åˆï¼Œè¿™äº›åŒ…å’Œmoduleä¸€èµ·æ‰“ç‰ˆæœ¬ã€å‘å¸ƒå’Œåˆ†å‘ã€‚go.modæ‰€åœ¨çš„ç›®å½•è¢«ç§°ä¸ºå®ƒå£°æ˜çš„moduleçš„æ ¹ç›®å½•ã€‚

ç¬¬ä¸€è¡Œå†…å®¹æ˜¯ç”¨äºå£°æ˜==moduleè·¯å¾„ï¼ˆmodule pathï¼‰==çš„ã€‚è€Œä¸”ï¼Œmoduleéšå«äº†ä¸€ä¸ª==å‘½åç©ºé—´==çš„æ¦‚å¿µï¼Œmoduleä¸‹æ¯ä¸ªåŒ…çš„å¯¼å…¥è·¯å¾„éƒ½æ˜¯ç”±**==module path==å’Œ==åŒ…æ‰€åœ¨å­ç›®å½•çš„åå­—==**ç»“åˆåœ¨ä¸€èµ·æ„æˆã€‚æ¯”å¦‚ï¼Œå¦‚æœhellomoduleä¸‹æœ‰å­ç›®å½•pkg/pkg1ï¼Œé‚£ä¹ˆpkg1ä¸‹é¢çš„åŒ…çš„å¯¼å…¥è·¯å¾„å°±æ˜¯ç”±module pathï¼ˆ`github.com/andyron/hellomodule`ï¼‰å’ŒåŒ…æ‰€åœ¨å­ç›®å½•çš„åå­—ï¼ˆpkg/pkg1ï¼‰ç»“åˆè€Œæˆï¼Œä¹Ÿå°±æ˜¯`github.com/andyron/hellomodule/pkg/pkg1`ã€‚

`go 1.22.1`æ˜¯ä¸€ä¸ªGoç‰ˆæœ¬æŒ‡ç¤ºç¬¦ï¼Œç”¨äºè¡¨ç¤ºè¿™ä¸ªmoduleæ˜¯åœ¨æŸä¸ªç‰¹å®šçš„Goç‰ˆæœ¬çš„moduleè¯­ä¹‰çš„åŸºç¡€ä¸Šç¼–å†™çš„ã€‚

> `go mod tidy`ï¼Œç”¨äºæ¸…ç†å’Œç®¡ç†é¡¹ç›®çš„ä¾èµ–å…³ç³»ï¼Œå¯ä»¥ç¡®ä¿ä½ çš„ `go.mod` å’Œ `go.sum` æ–‡ä»¶æ˜¯æœ€æ–°çš„ï¼Œå®ƒä¼šæ‰§è¡Œä¸‹é¢çš„æ“ä½œï¼š
>
> - **æ·»åŠ ç¼ºå¤±çš„ä¾èµ–**
> - **ç§»é™¤æœªä½¿ç”¨çš„ä¾èµ–**
> - **æ›´æ–°ä¾èµ–çš„ç‰ˆæœ¬**

`go.sum`æ–‡ä»¶è®°å½•äº†hellomoduleçš„**ç›´æ¥ä¾èµ–å’Œé—´æ¥ä¾èµ–åŒ…çš„ç›¸å…³ç‰ˆæœ¬çš„hashå€¼ï¼Œç”¨æ¥æ ¡éªŒæœ¬åœ°åŒ…çš„çœŸå®æ€§**ã€‚åœ¨æ„å»ºçš„æ—¶å€™ï¼Œå¦‚æœæœ¬åœ°ä¾èµ–åŒ…çš„hashå€¼ä¸go.sumæ–‡ä»¶ä¸­è®°å½•çš„ä¸ä¸€è‡´ï¼Œå°±ä¼šè¢«æ‹’ç»æ„å»ºã€‚



## 05 æ ‡å‡†å…ˆè¡Œï¼šGoé¡¹ç›®çš„å¸ƒå±€æ ‡å‡†æ˜¯ä»€ä¹ˆï¼Ÿ

### Goè¯­è¨€â€œåˆ›ä¸–é¡¹ç›®â€ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿ

â€œGoè¯­è¨€çš„åˆ›ä¸–é¡¹ç›®â€å°±æ˜¯Goè¯­è¨€é¡¹ç›®è‡ªèº«ã€‚





### ç°åœ¨çš„Goé¡¹ç›®çš„å…¸å‹ç»“æ„å¸ƒå±€æ˜¯æ€æ ·çš„ï¼Ÿ

#### 1ï¸âƒ£å¯æ‰§è¡Œç¨‹åºé¡¹ç›®

å…¸å‹äº”ä¸ªéƒ¨åˆ†ï¼š

- æ”¾åœ¨é¡¹ç›®é¡¶å±‚çš„Go Moduleç›¸å…³æ–‡ä»¶ï¼ŒåŒ…æ‹¬go.modå’Œgo.sumï¼›
- cmdç›®å½•ï¼šå­˜æ”¾é¡¹ç›®è¦ç¼–è¯‘æ„å»ºçš„å¯æ‰§è¡Œæ–‡ä»¶æ‰€å¯¹åº”çš„mainåŒ…çš„æºç æ–‡ä»¶ï¼›
- é¡¹ç›®åŒ…ç›®å½•ï¼šæ¯ä¸ªé¡¹ç›®ä¸‹çš„émainåŒ…éƒ½â€œå¹³é“ºâ€åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ¯ä¸ªç›®å½•å¯¹åº”ä¸€ä¸ªGoåŒ…ï¼›
- internalç›®å½•ï¼šå­˜æ”¾ä»…é¡¹ç›®å†…éƒ¨å¼•ç”¨çš„GoåŒ…ï¼Œè¿™äº›åŒ…æ— æ³•è¢«é¡¹ç›®ä¹‹å¤–å¼•ç”¨ï¼›
- vendorç›®å½•ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰ç›®å½•ï¼Œä¸ºäº†å…¼å®¹Go 1.5å¼•å…¥çš„vendoræ„å»ºæ¨¡å¼è€Œå­˜åœ¨çš„ã€‚è¿™ä¸ªç›®å½•ä¸‹çš„å†…å®¹å‡ç”±Goå‘½ä»¤è‡ªåŠ¨ç»´æŠ¤ï¼Œä¸éœ€è¦å¼€å‘è€…æ‰‹å·¥å¹²é¢„ã€‚



#### 2ï¸âƒ£åº“é¡¹ç›®

å»æ‰cmdç›®å½•å’Œvendorç›®å½•ã€‚



## 06 æ„å»ºæ¨¡å¼ï¼šGoæ˜¯æ€ä¹ˆè§£å†³åŒ…ä¾èµ–ç®¡ç†é—®é¢˜çš„ï¼Ÿ

### Goæ„å»ºæ¨¡å¼æ˜¯æ€ä¹ˆæ¼”åŒ–çš„ï¼Ÿ

Goç¨‹åºç”±GoåŒ…ç»„åˆè€Œæˆçš„ï¼ŒGoç¨‹åºçš„==æ„å»ºè¿‡ç¨‹==å°±æ˜¯**ç¡®å®šåŒ…ç‰ˆæœ¬ã€ç¼–è¯‘åŒ…ä»¥åŠå°†ç¼–è¯‘åå¾—åˆ°çš„ç›®æ ‡æ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·**çš„è¿‡ç¨‹ã€‚

Goè¯­è¨€çš„æ„å»ºæ¨¡å¼å†ç»äº†ä¸‰ä¸ªè¿­ä»£å’Œæ¼”åŒ–è¿‡ç¨‹ï¼š

### 1ï¸âƒ£æœ€åˆæœŸçš„GOPATH



### 2ï¸âƒ£1.5ç‰ˆæœ¬çš„Vendoræœºåˆ¶

vendoræœºåˆ¶æœ¬è´¨ä¸Šå°±æ˜¯åœ¨Goé¡¹ç›®çš„æŸä¸ªç‰¹å®šç›®å½•ä¸‹ï¼Œå°†é¡¹ç›®çš„æ‰€æœ‰ä¾èµ–åŒ…ç¼“å­˜èµ·æ¥ï¼Œè¿™ä¸ªç‰¹å®šç›®å½•åå°±æ˜¯vendorã€‚



### 3ï¸âƒ£ç°åœ¨çš„Go Module

ä¸€ä¸ªGo Moduleæ˜¯ä¸€ä¸ªGoåŒ…çš„é›†åˆã€‚moduleæ˜¯æœ‰ç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥moduleä¸‹çš„åŒ…ä¹Ÿå°±æœ‰äº†ç‰ˆæœ¬å±æ€§ã€‚è¿™ä¸ªmoduleä¸è¿™äº›åŒ…ä¼šç»„æˆä¸€ä¸ªç‹¬ç«‹çš„ç‰ˆæœ¬å•å…ƒï¼Œå®ƒä»¬ä¸€èµ·æ‰“ç‰ˆæœ¬ã€å‘å¸ƒå’Œåˆ†å‘ã€‚

åœ¨Go Moduleæ¨¡å¼ä¸‹ï¼Œé€šå¸¸ä¸€ä¸ªä»£ç ä»“åº“å¯¹åº”ä¸€ä¸ªGo Moduleã€‚ä¸€ä¸ªGo Moduleçš„é¡¶å±‚ç›®å½•ä¸‹ä¼šæ”¾ç½®ä¸€ä¸ªgo.modæ–‡ä»¶ï¼Œæ¯ä¸ªgo.modæ–‡ä»¶ä¼šå®šä¹‰å”¯ä¸€ä¸€ä¸ªmoduleï¼Œä¹Ÿå°±æ˜¯è¯´Go Moduleä¸go.modæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚

go.modæ–‡ä»¶æ‰€åœ¨çš„é¡¶å±‚ç›®å½•ä¹Ÿè¢«ç§°ä¸º**moduleçš„æ ¹ç›®å½•**ï¼Œmoduleæ ¹ç›®å½•ä»¥åŠå®ƒå­ç›®å½•ä¸‹çš„æ‰€æœ‰GoåŒ…å‡å½’å±äºè¿™ä¸ªGo Moduleï¼Œè¿™ä¸ªmoduleä¹Ÿè¢«ç§°ä¸º**main module**ã€‚

### åˆ›å»ºä¸€ä¸ªGo Module

æ­¥éª¤ï¼š

1. ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡go mod initåˆ›å»ºgo.modæ–‡ä»¶ï¼Œå°†å½“å‰é¡¹ç›®å˜ä¸ºä¸€ä¸ªGo Moduleï¼›
2. ç¬¬äºŒæ­¥ï¼Œé€šè¿‡go mod tidyå‘½ä»¤è‡ªåŠ¨æ›´æ–°å½“å‰moduleçš„ä¾èµ–ä¿¡æ¯ï¼›
3. ç¬¬ä¸‰æ­¥ï¼Œæ‰§è¡Œgo buildï¼Œæ‰§è¡Œæ–°moduleçš„æ„å»ºã€‚



ç”±`go mod tidy`ä¸‹è½½çš„ä¾èµ–moduleä¼šè¢«æ”¾ç½®åœ¨æœ¬åœ°çš„moduleç¼“å­˜è·¯å¾„ä¸‹ï¼Œé»˜è®¤å€¼ä¸º`$GOPATH[0]/pkg/mod`ï¼ŒGo 1.15åŠä»¥åç‰ˆæœ¬å¯ä»¥é€šè¿‡`GOMODCACHE`ç¯å¢ƒå˜é‡ï¼Œè‡ªå®šä¹‰æœ¬åœ°moduleçš„ç¼“å­˜è·¯å¾„ã€‚

> æ¨èæŠŠgo.modå’Œgo.sumä¸¤ä¸ªæ–‡ä»¶ä¸æºç ï¼Œä¸€å¹¶æäº¤åˆ°ä»£ç ç‰ˆæœ¬æ§åˆ¶æœåŠ¡å™¨ä¸Šã€‚

go buildå‘½ä»¤ä¼šè¯»å–go.modä¸­çš„ä¾èµ–åŠç‰ˆæœ¬ä¿¡æ¯ï¼Œå¹¶åœ¨æœ¬åœ°moduleç¼“å­˜è·¯å¾„ä¸‹æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„ä¾èµ–moduleï¼Œæ‰§è¡Œç¼–è¯‘å’Œé“¾æ¥ã€‚



é¡¹ç›®æ‰€ä¾èµ–çš„åŒ…æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼ŒGo Moduleæ˜¯å¦‚ä½•é€‰å‡ºæœ€é€‚åˆçš„é‚£ä¸ªç‰ˆæœ¬çš„å‘¢ï¼Ÿ

### æ·±å…¥Go Moduleæ„å»ºæ¨¡å¼

#### è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬(Semantic Import Versioning)

ç‰ˆæœ¬å·ï¼Œéƒ½ç¬¦åˆ`vX.Y.Z`çš„æ ¼å¼ï¼Œç”±==å‰ç¼€v==å’Œä¸€ä¸ª==æ»¡è¶³è¯­ä¹‰ç‰ˆæœ¬è§„èŒƒçš„ç‰ˆæœ¬å·==ç»„æˆã€‚è¯­ä¹‰ç‰ˆæœ¬å·åˆ†æˆ3éƒ¨åˆ†ï¼šä¸»ç‰ˆæœ¬å·(major)ã€æ¬¡ç‰ˆæœ¬å·(minor)å’Œè¡¥ä¸ç‰ˆæœ¬å·(patch)ã€‚

![](images/image-20240702171216789.png)

å€ŸåŠ©äºè¯­ä¹‰ç‰ˆæœ¬è§„èŒƒï¼ŒGoå‘½ä»¤å¯ä»¥ç¡®å®šåŒä¸€moduleçš„ä¸¤ä¸ªç‰ˆæœ¬å‘å¸ƒçš„å…ˆåæ¬¡åºï¼Œè€Œä¸”å¯ä»¥ç¡®å®šå®ƒä»¬æ˜¯å¦å…¼å®¹ã€‚

æŒ‰ç…§è¯­ä¹‰ç‰ˆæœ¬è§„èŒƒï¼Œ**ä¸»ç‰ˆæœ¬å·ä¸åŒçš„ä¸¤ä¸ªç‰ˆæœ¬æ˜¯ç›¸äº’ä¸å…¼å®¹çš„**ã€‚è€Œä¸”ï¼Œåœ¨ä¸»ç‰ˆæœ¬å·ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œ**æ¬¡ç‰ˆæœ¬å·å¤§éƒ½æ˜¯å‘åå…¼å®¹æ¬¡ç‰ˆæœ¬å·å°çš„ç‰ˆæœ¬ã€‚è¡¥ä¸ç‰ˆæœ¬å·ä¹Ÿä¸å½±å“å…¼å®¹æ€§**ã€‚

è€Œä¸”ï¼ŒGo Moduleè§„å®šï¼š**å¦‚æœåŒä¸€ä¸ªåŒ…çš„æ–°æ—§ç‰ˆæœ¬æ˜¯å…¼å®¹çš„ï¼Œé‚£ä¹ˆå®ƒä»¬çš„åŒ…å¯¼å…¥è·¯å¾„åº”è¯¥æ˜¯ç›¸åŒçš„**ã€‚ä»¥logrusä¸ºä¾‹ï¼Œé€‰å‡ºä¸¤ä¸ªç‰ˆæœ¬v1.7.0å’Œv1.8.1.ã€‚æŒ‰ç…§ä¸Šé¢çš„è¯­ä¹‰ç‰ˆæœ¬è§„åˆ™ï¼Œè¿™ä¸¤ä¸ªç‰ˆæœ¬çš„ä¸»ç‰ˆæœ¬å·ç›¸åŒï¼Œæ–°ç‰ˆæœ¬v1.8.1æ˜¯å…¼å®¹è€ç‰ˆæœ¬v1.7.0çš„ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ï¼Œå¦‚æœä¸€ä¸ªé¡¹ç›®ä¾èµ–logrusï¼Œæ— è®ºå®ƒä½¿ç”¨çš„æ˜¯v1.7.0ç‰ˆæœ¬è¿˜æ˜¯v1.8.1ç‰ˆæœ¬ï¼Œå®ƒéƒ½å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„åŒ…å¯¼å…¥è¯­å¥å¯¼å…¥logrusåŒ…ï¼š

```go
import "github.com/sirupsen/logrus"
```

> æ–°é—®é¢˜ï¼š
>
> å‡å¦‚åœ¨æœªæ¥çš„æŸä¸€å¤©ï¼Œlogrusçš„ä½œè€…å‘å¸ƒäº†logrus v2.0.0ç‰ˆæœ¬ã€‚é‚£ä¹ˆæ ¹æ®è¯­ä¹‰ç‰ˆæœ¬è§„åˆ™ï¼Œè¯¥ç‰ˆæœ¬çš„ä¸»ç‰ˆæœ¬å·ä¸º2ï¼Œå·²ç»ä¸v1.7.0ã€v1.8.1çš„ä¸»ç‰ˆæœ¬å·ä¸åŒäº†ï¼Œé‚£ä¹ˆv2.0.0ä¸v1.7.0ã€v1.8.1å°±æ˜¯ä¸å…¼å®¹çš„åŒ…ç‰ˆæœ¬ã€‚ç„¶åæˆ‘ä»¬å†æŒ‰ç…§Go Moduleçš„è§„å®šï¼Œå¦‚æœä¸€ä¸ªé¡¹ç›®ä¾èµ–logrus v2.0.0ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå®ƒçš„åŒ…å¯¼å…¥è·¯å¾„å°±ä¸èƒ½å†ä¸ä¸Šé¢çš„å¯¼å…¥æ–¹å¼ç›¸åŒäº†ã€‚é‚£æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ–¹å¼å¯¼å…¥logrus v2.0.0ç‰ˆæœ¬å‘¢ï¼Ÿ

Go Moduleåˆ›æ–°æ€§åœ°ç»™å‡ºäº†ä¸€ä¸ªæ–¹æ³•ï¼š**å°†åŒ…ä¸»ç‰ˆæœ¬å·å¼•å…¥åˆ°åŒ…å¯¼å…¥è·¯å¾„ä¸­**ï¼š

```go
import "github.com/sirupsen/logrus/v2"
```

ç”šè‡³å¯ä»¥åŒæ—¶ä¾èµ–ä¸€ä¸ªåŒ…çš„ä¸¤ä¸ªä¸å…¼å®¹ç‰ˆæœ¬ï¼š

```go
import (
  "github.com/sirupsen/logrus"
  logv2 "github.com/sirupsen/logrus/v2"
)
```



> v0.y.zç‰ˆæœ¬åº”è¯¥ä½¿ç”¨å“ªç§å¯¼å…¥è·¯å¾„å‘¢ï¼Ÿ
>
> v0.y.zè¿™æ ·çš„ç‰ˆæœ¬å·æ˜¯ç”¨äºé¡¹ç›®åˆå§‹å¼€å‘é˜¶æ®µçš„ç‰ˆæœ¬å·ã€‚åœ¨è¿™ä¸ªé˜¶æ®µä»»ä½•äº‹æƒ…éƒ½æœ‰å¯èƒ½å‘ç”Ÿï¼Œå…¶APIä¹Ÿä¸åº”è¯¥è¢«è®¤ä¸ºæ˜¯ç¨³å®šçš„ã€‚Go Moduleå°†è¿™æ ·çš„ç‰ˆæœ¬(v0)ä¸ä¸»ç‰ˆæœ¬å·v1åšåŒç­‰å¯¹å¾…ï¼Œä¹Ÿå°±æ˜¯é‡‡ç”¨ä¸å¸¦ä¸»ç‰ˆæœ¬å·çš„åŒ…å¯¼å…¥è·¯å¾„ï¼Œè¿™æ ·ä¸€å®šç¨‹åº¦é™ä½äº†Goå¼€å‘äººå‘˜ä½¿ç”¨è¿™æ ·ç‰ˆæœ¬å·åŒ…æ—¶çš„å¿ƒæ™ºè´Ÿæ‹…ã€‚

#### æœ€å°ç‰ˆæœ¬é€‰æ‹©(Minimal Version Selection)

![](images/image-20240702171932253.png)

> myprojectæœ‰ä¸¤ä¸ªç›´æ¥ä¾èµ–Aå’ŒBï¼ŒAå’ŒBæœ‰ä¸€ä¸ªå…±åŒçš„ä¾èµ–åŒ…Cï¼Œä½†Aä¾èµ–Cçš„v1.1.0ç‰ˆæœ¬ï¼Œè€ŒBä¾èµ–çš„æ˜¯Cçš„v1.3.0ç‰ˆæœ¬ï¼Œå¹¶ä¸”æ­¤æ—¶CåŒ…çš„æœ€æ–°å‘å¸ƒç‰ˆä¸ºC v1.7.0ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒGoå‘½ä»¤æ˜¯å¦‚ä½•ä¸ºmyprojecté€‰å‡ºé—´æ¥ä¾èµ–åŒ…Cçš„ç‰ˆæœ¬å‘¢ï¼Ÿé€‰å‡ºçš„ç©¶ç«Ÿæ˜¯v1.7.0ã€v1.1.0è¿˜æ˜¯v1.3.0å‘¢ï¼Ÿ

å½“å‰å­˜åœ¨çš„ä¸»æµç¼–ç¨‹è¯­è¨€ï¼Œä»¥åŠGo Moduleå‡ºç°ä¹‹å‰çš„å¾ˆå¤šGoåŒ…ä¾èµ–ç®¡ç†å·¥å…·éƒ½ä¼šé€‰æ‹©ä¾èµ–é¡¹çš„â€œ**æœ€æ–°æœ€å¤§(Latest Greatest)ç‰ˆæœ¬**â€ï¼Œä¹Ÿå°±æ˜¯v1.7.0ã€‚

Goè®¾è®¡è€…å¦è¾Ÿè¹Šå¾„ï¼Œåœ¨è¯¸å¤šå…¼å®¹æ€§ç‰ˆæœ¬é—´ï¼Œä»–ä»¬ä¸å…‰è¦è€ƒè™‘æœ€æ–°æœ€å¤§çš„ç¨³å®šä¸å®‰å…¨ï¼Œè¿˜è¦å°Šé‡å„ä¸ªmoduleçš„è¿°æ±‚ï¼šAæ˜æ˜è¯´åªè¦æ±‚C v1.1.0ï¼ŒBæ˜æ˜è¯´åªè¦æ±‚C v1.3.0ã€‚æ‰€ä»¥Goä¼šåœ¨è¯¥é¡¹ç›®ä¾èµ–é¡¹çš„æ‰€æœ‰ç‰ˆæœ¬ä¸­ï¼Œé€‰å‡ºç¬¦åˆé¡¹ç›®æ•´ä½“è¦æ±‚çš„â€œæœ€å°ç‰ˆæœ¬â€ã€‚

è¿™ä¸ªä¾‹å­ä¸­ï¼ŒC v1.3.0æ˜¯ç¬¦åˆé¡¹ç›®æ•´ä½“è¦æ±‚çš„ç‰ˆæœ¬é›†åˆä¸­çš„ç‰ˆæœ¬æœ€å°çš„é‚£ä¸ªï¼Œäºæ˜¯Goå‘½ä»¤é€‰æ‹©äº†C v1.3.0ï¼Œè€Œä¸æ˜¯æœ€æ–°æœ€å¤§çš„C v1.7.0ã€‚Goå›¢é˜Ÿè®¤ä¸º**â€œæœ€å°ç‰ˆæœ¬é€‰æ‹©â€ä¸ºGoç¨‹åºå®ç°æŒä¹…çš„å’Œå¯é‡ç°çš„æ„å»ºæä¾›äº†æœ€ä½³çš„æ–¹æ¡ˆ**ã€‚



### Goå„ç‰ˆæœ¬æ„å»ºæ¨¡å¼æœºåˆ¶å’Œåˆ‡æ¢

![](images/image-20240702172417325.png)



## 07 æ„å»ºæ¨¡å¼ï¼šGoModuleçš„6ç±»å¸¸è§„æ“ä½œ

### ä¸ºå½“å‰moduleæ·»åŠ ä¸€ä¸ªä¾èµ–

```go
package main

import "github.com/sirupsen/logrus"
import "github.com/google/uuid"

func main() {
	logrus.Println("hello, go module mode.")
	logrus.Println(uuid.NewString())
}
```

å¯ä»¥`go get github.com/google/uuid`ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`go mod tidy`å‘½ä»¤ï¼Œåœ¨æ‰§è¡Œæ„å»ºå‰è‡ªåŠ¨åˆ†ææºç ä¸­çš„ä¾èµ–å˜åŒ–ï¼Œè¯†åˆ«æ–°å¢ä¾èµ–é¡¹å¹¶ä¸‹è½½å®ƒä»¬ã€‚

### å‡çº§/é™çº§ä¾èµ–çš„ç‰ˆæœ¬

```sh
$ go list -m -versions github.com/sirupsen/logrus
github.com/sirupsen/logrus v0.1.0 v0.1.1 v0.2.0 v0.3.0 v0.4.0 v0.4.1 v0.5.0 v0.5.1 v0.6.0 v0.6.1 v0.6.2 v0.6.3 v0.6.4 v0.6.5 v0.6.6 v0.7.0 v0.7.1 v0.7.2 v0.7.3 v0.8.0 v0.8.1 v0.8.2 v0.8.3 v0.8.4 v0.8.5 v0.8.6 v0.8.7 v0.9.0 v0.10.0 v0.11.0 v0.11.1 v0.11.2 v0.11.3 v0.11.4 v0.11.5 v1.0.0 v1.0.1 v1.0.3 v1.0.4 v1.0.5 v1.0.6 v1.1.0 v1.1.1 v1.2.0 v1.3.0 v1.4.0 v1.4.1 v1.4.2 v1.5.0 v1.6.0 v1.7.0 v1.7.1 v1.8.0 v1.8.1 v1.8.2 v1.8.3 v1.9.0 v1.9.1 v1.9.2 v1.9.3
```

é™çº§ï¼š

```sh
$ go get github.com/google/uuid@v1.7.0
```

æˆ–

```sh
$ go mod edit -require=github.com/sirupsen/logrus@v1.7.0
$ go mod tidy       
go: downloading github.com/sirupsen/logrus v1.7.0
```



å‡çº§ï¼š

```sh
$ go get github.com/google/uuid@v1.7.1
```



åœ¨Go Moduleæ„å»ºæ¨¡å¼ä¸‹ï¼Œå½“ä¾èµ–çš„ä¸»ç‰ˆæœ¬å·ä¸º0æˆ–1çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨Goæºç ä¸­å¯¼å…¥ä¾èµ–åŒ…ï¼Œä¸éœ€è¦åœ¨åŒ…çš„å¯¼å…¥è·¯å¾„ä¸Šå¢åŠ ç‰ˆæœ¬å·ï¼Œä¹Ÿå°±æ˜¯ï¼š

```go
import github.com/user/repo/v0 ç­‰ä»·äº import github.com/user/repo
import github.com/user/repo/v1 ç­‰ä»·äº import github.com/user/repo
```



### æ·»åŠ ä¸€ä¸ªä¸»ç‰ˆæœ¬å·å¤§äº1çš„ä¾èµ–

è¯­ä¹‰å¯¼å…¥ç‰ˆæœ¬æœºåˆ¶æœ‰ä¸€ä¸ªåŸåˆ™ï¼š**å¦‚æœæ–°æ—§ç‰ˆæœ¬çš„åŒ…ä½¿ç”¨ç›¸åŒçš„å¯¼å…¥è·¯å¾„ï¼Œé‚£ä¹ˆæ–°åŒ…ä¸æ—§åŒ…æ˜¯å…¼å®¹çš„**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ–°æ—§ä¸¤ä¸ªåŒ…ä¸å…¼å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥é‡‡ç”¨ä¸åŒçš„å¯¼å…¥è·¯å¾„ã€‚

```go
import github.com/user/repo/v2/xxx
```

ä¸»ç‰ˆæœ¬å·å¤§äº1çš„ä¾èµ–ï¼Œ**åœ¨å£°æ˜å®ƒçš„å¯¼å…¥è·¯å¾„çš„åŸºç¡€ä¸Šï¼ŒåŠ ä¸Šç‰ˆæœ¬å·ä¿¡æ¯**ã€‚



### å‡çº§ä¾èµ–ç‰ˆæœ¬åˆ°ä¸€ä¸ªä¸å…¼å®¹ç‰ˆæœ¬





### ç§»é™¤ä¸€ä¸ªä¾èµ–

åˆ—å‡ºå½“å‰moduleçš„æ‰€æœ‰ä¾èµ–ï¼š

```sh
$ go list -m all
```



åˆ é™¤ä»£ç ä¸­å¯¹åŒ…ä¾èµ–ï¼Œç„¶å`go build`æ˜¯ä¸ä¼šä»å½“å‰moduleä¸­ç§»é™¤ç›¸å…³ä¾èµ–çš„ï¼Œéœ€è¦ä½¿ç”¨`go mod tidy`å‘½ä»¤ã€‚

go mod tidyä¼šè‡ªåŠ¨åˆ†ææºç ä¾èµ–ï¼Œè€Œä¸”å°†ä¸å†ä½¿ç”¨çš„ä¾èµ–ä»go.modå’Œgo.sumä¸­ç§»é™¤ã€‚



### ç‰¹æ®Šæƒ…å†µï¼šä½¿ç”¨vendorğŸ”–





### æ€è€ƒé¢˜

> å¦‚æœä½ æ˜¯ä¸€ä¸ªå…¬å…±GoåŒ…çš„ä½œè€…ï¼Œåœ¨å‘å¸ƒä½ çš„GoåŒ…æ—¶ï¼Œæœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Ÿ



## 08 å…¥å£å‡½æ•°ä¸åŒ…åˆå§‹åŒ–ï¼šææ¸…Goç¨‹åºçš„æ‰§è¡Œæ¬¡åº

### main.mainå‡½æ•°ï¼šGoåº”ç”¨çš„å…¥å£å‡½æ•°

Goè¯­è¨€è¦æ±‚ï¼š**å¯æ‰§è¡Œç¨‹åºçš„mainåŒ…å¿…é¡»å®šä¹‰mainå‡½æ•°ï¼Œå¦åˆ™Goç¼–è¯‘å™¨ä¼šæŠ¥é”™**ã€‚åœ¨å¯åŠ¨äº†å¤šä¸ªGoroutineçš„Goåº”ç”¨ä¸­ï¼Œmain.mainå‡½æ•°å°†åœ¨Goåº”ç”¨çš„ä¸»Goroutineä¸­æ‰§è¡Œã€‚

ä¸è¿‡å¾ˆæœ‰æ„æ€çš„æ˜¯ï¼Œåœ¨å¤šGoroutineçš„Goåº”ç”¨ä¸­ï¼Œç›¸è¾ƒäºmain.mainä½œä¸ºGoåº”ç”¨çš„å…¥å£ï¼Œ**main.mainå‡½æ•°è¿”å›çš„æ„ä¹‰å…¶å®æ›´å¤§**ï¼Œå› ä¸ºmainå‡½æ•°è¿”å›å°±æ„å‘³ç€æ•´ä¸ªGoç¨‹åºçš„ç»ˆç»“ï¼Œè€Œä¸”ä½ ä¹Ÿä¸ç”¨ç®¡è¿™ä¸ªæ—¶å€™æ˜¯å¦è¿˜æœ‰å…¶ä»–å­Goroutineæ­£åœ¨æ‰§è¡Œã€‚



é™¤äº†mainåŒ…å¤–ï¼Œå…¶ä»–åŒ…ä¹Ÿå¯ä»¥æ‹¥æœ‰è‡ªå·±çš„åä¸ºmainçš„å‡½æ•°æˆ–æ–¹æ³•ã€‚ä½†æŒ‰ç…§Goçš„å¯è§æ€§è§„åˆ™ï¼ˆå°å†™å­—æ¯å¼€å¤´çš„æ ‡è¯†ç¬¦ä¸ºéå¯¼å‡ºæ ‡è¯†ç¬¦ï¼‰ï¼ŒémainåŒ…ä¸­è‡ªå®šä¹‰çš„mainå‡½æ•°ä»…é™äºåŒ…å†…ä½¿ç”¨ã€‚

> å¯¹äºmainåŒ…çš„mainå‡½æ•°æ¥è¯´ï¼Œè™½ç„¶æ˜¯ç”¨æˆ·å±‚é€»è¾‘çš„å…¥å£å‡½æ•°ï¼Œä½†å®ƒå´**ä¸ä¸€å®šæ˜¯ç”¨æˆ·å±‚ç¬¬ä¸€ä¸ªè¢«æ‰§è¡Œçš„å‡½æ•°**ã€‚

### initå‡½æ•°ï¼šGoåŒ…çš„åˆå§‹åŒ–å‡½æ•°

å¦‚æœmainåŒ…ä¾èµ–çš„åŒ…ä¸­å®šä¹‰äº†initå‡½æ•°ï¼Œæˆ–è€…æ˜¯mainåŒ…è‡ªèº«å®šä¹‰äº†initå‡½æ•°ï¼Œé‚£ä¹ˆGoç¨‹åºåœ¨è¿™ä¸ªåŒ…åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒçš„initå‡½æ•°ï¼Œå› æ­¤è¿™äº›initå‡½æ•°çš„æ‰§è¡Œå°±éƒ½ä¼šå‘ç”Ÿåœ¨mainå‡½æ•°ä¹‹å‰ã€‚



### GoåŒ…çš„åˆå§‹åŒ–æ¬¡åº

ä»ç¨‹åºé€»è¾‘ç»“æ„è§’åº¦æ¥çœ‹ï¼ŒGoåŒ…æ˜¯ç¨‹åºé€»è¾‘å°è£…çš„åŸºæœ¬å•å…ƒï¼Œæ¯ä¸ªåŒ…éƒ½å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªâ€œè‡ªæ²»â€çš„ã€å°è£…è‰¯å¥½çš„ã€å¯¹å¤–éƒ¨æš´éœ²æœ‰é™æ¥å£çš„åŸºæœ¬å•å…ƒã€‚ä¸€ä¸ªGoç¨‹åºå°±æ˜¯ç”±ä¸€ç»„åŒ…ç»„æˆçš„ï¼Œç¨‹åºçš„åˆå§‹åŒ–å°±æ˜¯è¿™äº›åŒ…çš„åˆå§‹åŒ–ã€‚æ¯ä¸ªGoåŒ…è¿˜ä¼šæœ‰è‡ªå·±çš„ä¾èµ–åŒ…ã€å¸¸é‡ã€å˜é‡ã€initå‡½æ•°ï¼ˆå…¶ä¸­mainåŒ…æœ‰mainå‡½æ•°ï¼‰ç­‰ã€‚

> æ³¨æ„ğŸ“¢ï¼šæˆ‘ä»¬åœ¨é˜…è¯»å’Œç†è§£ä»£ç çš„æ—¶å€™ï¼Œéœ€è¦çŸ¥é“è¿™äº›å…ƒç´ åœ¨åœ¨ç¨‹åºåˆå§‹åŒ–è¿‡ç¨‹ä¸­çš„åˆå§‹åŒ–é¡ºåºï¼Œè¿™æ ·ä¾¿äºæˆ‘ä»¬ç¡®å®šåœ¨æŸä¸€è¡Œä»£ç å¤„è¿™äº›å…ƒç´ çš„å½“å‰çŠ¶æ€ã€‚

GoåŒ…çš„åˆå§‹åŒ–æ¬¡åºï¼š

![](images/image-20240702182932741.png)

1. é¦–å…ˆï¼ŒmainåŒ…ä¾èµ–pkg1å’Œpkg4ä¸¤ä¸ªåŒ…ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥ï¼ŒGoä¼šæ ¹æ®åŒ…å¯¼å…¥çš„é¡ºåºï¼Œå…ˆå»åˆå§‹åŒ–mainåŒ…çš„ç¬¬ä¸€ä¸ªä¾èµ–åŒ…pkg1ã€‚
2. ç¬¬äºŒæ­¥ï¼ŒGoåœ¨è¿›è¡ŒåŒ…åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šé‡‡ç”¨â€œ==æ·±åº¦ä¼˜å…ˆ==â€çš„åŸåˆ™ï¼Œé€’å½’åˆå§‹åŒ–å„ä¸ªåŒ…çš„ä¾èµ–åŒ…ã€‚åœ¨ä¸Šå›¾é‡Œï¼Œpkg1åŒ…ä¾èµ–pkg2åŒ…ï¼Œpkg2åŒ…ä¾èµ–pkg3åŒ…ï¼Œpkg3æ²¡æœ‰ä¾èµ–åŒ…ï¼Œäºæ˜¯Goåœ¨pkg3åŒ…ä¸­æŒ‰ç…§â€œ==å¸¸é‡ -> å˜é‡ -> initå‡½æ•°==â€çš„é¡ºåºå…ˆå¯¹pkg3åŒ…è¿›è¡Œåˆå§‹åŒ–ï¼›
3. ç´§æ¥ç€ï¼Œåœ¨pkg3åŒ…åˆå§‹åŒ–å®Œæ¯•åï¼ŒGoä¼šå›åˆ°pkg2åŒ…å¹¶å¯¹pkg2åŒ…è¿›è¡Œåˆå§‹åŒ–ï¼Œæ¥ä¸‹æ¥å†å›åˆ°pkg1åŒ…å¹¶å¯¹pkg1åŒ…è¿›è¡Œåˆå§‹åŒ–ã€‚åœ¨è°ƒç”¨å®Œpkg1åŒ…çš„initå‡½æ•°åï¼ŒGoå°±å®Œæˆäº†mainåŒ…çš„ç¬¬ä¸€ä¸ªä¾èµ–åŒ…pkg1çš„åˆå§‹åŒ–ã€‚
4. æ¥ä¸‹æ¥ï¼ŒGoä¼šåˆå§‹åŒ–mainåŒ…çš„ç¬¬äºŒä¸ªä¾èµ–åŒ…pkg4ï¼Œpkg4åŒ…çš„åˆå§‹åŒ–è¿‡ç¨‹ä¸pkg1åŒ…ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å…ˆåˆå§‹åŒ–å®ƒçš„ä¾èµ–åŒ…pkg5ï¼Œç„¶åå†åˆå§‹åŒ–è‡ªèº«ï¼›ç„¶åï¼Œå½“Goåˆå§‹åŒ–å®Œpkg4åŒ…åä¹Ÿå°±å®Œæˆäº†å¯¹mainåŒ…æ‰€æœ‰ä¾èµ–åŒ…çš„åˆå§‹åŒ–ï¼Œæ¥ä¸‹æ¥åˆå§‹åŒ–mainåŒ…è‡ªèº«ã€‚
5. æœ€åï¼Œåœ¨mainåŒ…ä¸­ï¼ŒGoåŒæ ·ä¼šæŒ‰ç…§â€œå¸¸é‡ -> å˜é‡ -> initå‡½æ•°â€çš„é¡ºåºè¿›è¡Œåˆå§‹åŒ–ï¼Œæ‰§è¡Œå®Œè¿™äº›åˆå§‹åŒ–å·¥ä½œåæ‰æ­£å¼è¿›å…¥ç¨‹åºçš„å…¥å£å‡½æ•°mainå‡½æ•°ã€‚



ğŸ”–  åŒ…å¼•å…¥é”™è¯¯ï¼Ÿå˜é‡å’Œå¸¸é‡çš„æ‰§è¡Œé¡ºåºä¸ºä»€ä¹ˆåäº†ï¼Ÿ



GoåŒ…çš„åˆå§‹åŒ–æ¬¡åºï¼Œä¸‰ç‚¹ï¼š

- ä¾èµ–åŒ…æŒ‰â€œæ·±åº¦ä¼˜å…ˆâ€çš„æ¬¡åºè¿›è¡Œåˆå§‹åŒ–ï¼›
- æ¯ä¸ªåŒ…å†…æŒ‰ä»¥â€œå¸¸é‡ -> å˜é‡ -> initå‡½æ•°â€çš„é¡ºåºè¿›è¡Œåˆå§‹åŒ–ï¼›
- åŒ…å†…çš„å¤šä¸ªinitå‡½æ•°æŒ‰å‡ºç°æ¬¡åºè¿›è¡Œè‡ªåŠ¨è°ƒç”¨ã€‚



### initå‡½æ•°çš„ç”¨é€”

GoåŒ…åˆå§‹åŒ–æ—¶ï¼Œinitå‡½æ•°çš„åˆå§‹åŒ–æ¬¡åºåœ¨å˜é‡ä¹‹åï¼Œè¿™ç»™äº†å¼€å‘äººå‘˜åœ¨initå‡½æ•°ä¸­**å¯¹åŒ…çº§å˜é‡è¿›è¡Œè¿›ä¸€æ­¥æ£€æŸ¥ä¸æ“ä½œ**çš„æœºä¼šã€‚

#### ç”¨é€”1ï¼šé‡ç½®åŒ…çº§å˜é‡å€¼

è´Ÿè´£å¯¹åŒ…å†…éƒ¨ä»¥åŠæš´éœ²åˆ°å¤–éƒ¨çš„åŒ…çº§æ•°æ®ï¼ˆä¸»è¦æ˜¯åŒ…çº§å˜é‡ï¼‰çš„åˆå§‹çŠ¶æ€è¿›è¡Œæ£€æŸ¥ã€‚

ä¾‹å¦‚ï¼Œæ ‡å‡†åº“flagåŒ…ï¼šğŸ”–

flagåŒ…å®šä¹‰äº†ä¸€ä¸ªå¯¼å‡ºçš„åŒ…çº§å˜é‡CommandLineï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰é€šè¿‡flag.NewFlagSetåˆ›å»ºæ–°çš„ä»£è¡¨å‘½ä»¤è¡Œæ ‡å¿—é›†åˆçš„å®ä¾‹ï¼Œé‚£ä¹ˆCommandLineå°±ä¼šä½œä¸ºflagåŒ…å„ç§å¯¼å‡ºå‡½æ•°èƒŒåï¼Œé»˜è®¤çš„ä»£è¡¨å‘½ä»¤è¡Œæ ‡å¿—é›†åˆçš„å®ä¾‹ã€‚

```go
var CommandLine = NewFlagSet(os.Args[0], ExitOnError)

func NewFlagSet(name string, errorHandling ErrorHandling) *FlagSet {
    f := &FlagSet{
        name:          name,
        errorHandling: errorHandling,
    }
    f.Usage = f.defaultUsage
    return f
}

func (f *FlagSet) defaultUsage() {
    if f.name == "" {
        fmt.Fprintf(f.Output(), "Usage:\n")
    } else {
        fmt.Fprintf(f.Output(), "Usage of %s:\n", f.name)
    }
    f.PrintDefaults()
}
```

åœ¨é€šè¿‡NewFlagSetåˆ›å»ºCommandLineå˜é‡ç»‘å®šçš„FlagSetç±»å‹å®ä¾‹æ—¶ï¼ŒCommandLineçš„Usageå­—æ®µè¢«èµ‹å€¼ä¸ºdefaultUsageã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¿æŒç°çŠ¶ï¼Œé‚£ä¹ˆä½¿ç”¨flagåŒ…é»˜è®¤CommandLineçš„ç”¨æˆ·å°±æ— æ³•è‡ªå®šä¹‰usageçš„è¾“å‡ºäº†ã€‚äºæ˜¯ï¼ŒflagåŒ…åœ¨initå‡½æ•°ä¸­é‡ç½®äº†CommandLineçš„Usageå­—æ®µï¼š

```go
func init() {
    CommandLine.Usage = commandLineUsage // é‡ç½®CommandLineçš„Usageå­—æ®µ
}

func commandLineUsage() {
    Usage()
}

var Usage = func() {
    fmt.Fprintf(CommandLine.Output(), "Usage of %s:\n", os.Args[0])
    PrintDefaults()
}
```

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¼šå‘ç°ï¼ŒCommandLineçš„Usageå­—æ®µï¼Œè®¾ç½®ä¸ºäº†ä¸€ä¸ªflagåŒ…å†…çš„æœªå¯¼å‡ºå‡½æ•°commandLineUsageï¼Œåè€…åˆ™ç›´æ¥ä½¿ç”¨äº†flagåŒ…çš„å¦å¤–ä¸€ä¸ªå¯¼å‡ºåŒ…å˜é‡Usageã€‚è¿™æ ·ï¼Œå°±å¯ä»¥é€šè¿‡initå‡½æ•°ï¼Œå°†CommandLineä¸åŒ…å˜é‡Usageå…³è”åœ¨ä¸€èµ·äº†ã€‚

ç„¶åï¼Œå½“ç”¨æˆ·å°†è‡ªå®šä¹‰çš„usageèµ‹å€¼ç»™äº†flag.Usageåï¼Œå°±ç›¸å½“äºæ”¹å˜äº†é»˜è®¤ä»£è¡¨å‘½ä»¤è¡Œæ ‡å¿—é›†åˆçš„CommandLineå˜é‡çš„Usageã€‚è¿™æ ·å½“flagåŒ…å®Œæˆåˆå§‹åŒ–åï¼ŒCommandLineå˜é‡ä¾¿å¤„äºä¸€ä¸ªåˆç†å¯ç”¨çš„çŠ¶æ€äº†ã€‚

#### ç”¨é€”2ï¼šå®ç°å¯¹åŒ…çº§å˜é‡çš„å¤æ‚åˆå§‹åŒ–

äº›åŒ…çº§å˜é‡éœ€è¦ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œæœ‰äº›æ—¶å€™ï¼Œä½¿ç”¨å®ƒçš„**ç±»å‹é›¶å€¼**ï¼ˆæ¯ä¸ªGoç±»å‹éƒ½å…·æœ‰ä¸€ä¸ªé›¶å€¼å®šä¹‰ï¼‰æˆ–é€šè¿‡ç®€å•åˆå§‹åŒ–è¡¨è¾¾å¼ä¸èƒ½æ»¡è¶³ä¸šåŠ¡é€»è¾‘è¦æ±‚ï¼Œè€Œinitå‡½æ•°åˆ™éå¸¸é€‚åˆå®Œæˆæ­¤é¡¹å·¥ä½œï¼Œæ ‡å‡†åº“httpåŒ…ä¸­å°±æœ‰è¿™æ ·ä¸€ä¸ªå…¸å‹ç¤ºä¾‹ï¼š

```go
// net/http/h2_bundle.go
var (
    http2VerboseLogs    bool // åˆå§‹åŒ–æ—¶é»˜è®¤å€¼ä¸ºfalse
    http2logFrameWrites bool // åˆå§‹åŒ–æ—¶é»˜è®¤å€¼ä¸ºfalse
    http2logFrameReads  bool // åˆå§‹åŒ–æ—¶é»˜è®¤å€¼ä¸ºfalse
    http2inTests        bool // åˆå§‹åŒ–æ—¶é»˜è®¤å€¼ä¸ºfalse
)

func init() {
    e := os.Getenv("GODEBUG")
    if strings.Contains(e, "http2debug=1") {
        http2VerboseLogs = true // åœ¨initä¸­å¯¹http2VerboseLogsçš„å€¼è¿›è¡Œé‡ç½®
    }
    if strings.Contains(e, "http2debug=2") {
        http2VerboseLogs = true // åœ¨initä¸­å¯¹http2VerboseLogsçš„å€¼è¿›è¡Œé‡ç½®
        http2logFrameWrites = true // åœ¨initä¸­å¯¹http2logFrameWritesçš„å€¼è¿›è¡Œé‡ç½®
        http2logFrameReads = true // åœ¨initä¸­å¯¹http2logFrameReadsçš„å€¼è¿›è¡Œé‡ç½®
    }
}
```

httpåŒ…å®šä¹‰äº†ä¸€ç³»åˆ—å¸ƒå°”ç±»å‹çš„ç‰¹æ€§å¼€å…³å˜é‡ï¼Œå¯ä»¥é€šè¿‡GODEBUGç¯å¢ƒå˜é‡çš„å€¼ï¼Œå¼€å¯ç›¸å…³ç‰¹æ€§å¼€å…³ã€‚

#### ç”¨é€”3ï¼šåœ¨initå‡½æ•°ä¸­å®ç°â€œæ³¨å†Œæ¨¡å¼â€

lib/pqåŒ…è®¿é—®PostgreSQLæ•°æ®åº“çš„ä»£ç ç¤ºä¾‹ï¼š

```go
import (
    "database/sql"
    _ "github.com/lib/pq"
)

func main() {
    db, err := sql.Open("postgres", "user=pqgotest dbname=pqgotest sslmode=verify-full")
    if err != nil {
        log.Fatal(err)
    }
    
    age := 21
    rows, err := db.Query("SELECT name FROM users WHERE age = $1", age)
    ...
}
```

ä»¥ç©ºå¯¼å…¥çš„æ–¹å¼å¯¼å…¥[lib/pq](https://github.com/lib/pq)åŒ…çš„ï¼Œmainå‡½æ•°ä¸­æ²¡æœ‰ä½¿ç”¨pqåŒ…çš„ä»»ä½•å˜é‡ã€å‡½æ•°æˆ–æ–¹æ³•ï¼Œè¿™æ ·å°±å®ç°äº†å¯¹PostgreSQLæ•°æ®åº“çš„è®¿é—®ã€‚è€Œè¿™ä¸€åˆ‡çš„å¥¥ç§˜ï¼Œå…¨åœ¨pqåŒ…çš„initå‡½æ•°ä¸­ï¼š

```go
func init() {
    sql.Register("postgres", &Driver{})
}
```

åˆ©ç”¨äº†ç”¨ç©ºå¯¼å…¥çš„æ–¹å¼å¯¼å…¥lib/pqåŒ…æ—¶äº§ç”Ÿçš„ä¸€ä¸ªâ€œå‰¯ä½œç”¨â€ï¼Œä¹Ÿå°±æ˜¯lib/pqåŒ…ä½œä¸ºmainåŒ…çš„ä¾èµ–åŒ…ï¼Œå®ƒçš„initå‡½æ•°ä¼šåœ¨pqåŒ…åˆå§‹åŒ–çš„æ—¶å€™å¾—ä»¥æ‰§è¡Œã€‚

initå‡½æ•°ä¸­ï¼ŒpqåŒ…å°†è‡ªå·±å®ç°çš„sqlé©±åŠ¨æ³¨å†Œåˆ°äº†sqlåŒ…ä¸­ã€‚è¿™æ ·åªè¦åº”ç”¨å±‚ä»£ç åœ¨Openæ•°æ®åº“çš„æ—¶å€™ï¼Œä¼ å…¥é©±åŠ¨çš„åå­—ï¼ˆè¿™é‡Œæ˜¯â€œpostgresâ€)ï¼Œé‚£ä¹ˆé€šè¿‡sql.Openå‡½æ•°ï¼Œè¿”å›çš„æ•°æ®åº“å®ä¾‹å¥æŸ„å¯¹æ•°æ®åº“è¿›è¡Œçš„æ“ä½œï¼Œå®é™…ä¸Šè°ƒç”¨çš„éƒ½æ˜¯pqåŒ…ä¸­ç›¸åº”çš„é©±åŠ¨å®ç°ã€‚

å®é™…ä¸Šï¼Œè¿™ç§**é€šè¿‡åœ¨initå‡½æ•°ä¸­æ³¨å†Œè‡ªå·±çš„å®ç°çš„æ¨¡å¼ï¼Œå°±æœ‰æ•ˆé™ä½äº†GoåŒ…å¯¹å¤–çš„ç›´æ¥æš´éœ²ï¼Œå°¤å…¶æ˜¯åŒ…çº§å˜é‡çš„æš´éœ²**ï¼Œä»è€Œé¿å…äº†å¤–éƒ¨é€šè¿‡åŒ…çº§å˜é‡å¯¹åŒ…çŠ¶æ€çš„æ”¹åŠ¨ã€‚

å¦å¤–ï¼Œä»æ ‡å‡†åº“database/sqlåŒ…çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ç§â€œæ³¨å†Œæ¨¡å¼â€å®è´¨æ˜¯ä¸€ç§**å·¥å‚è®¾è®¡æ¨¡å¼**çš„å®ç°ï¼Œsql.Openå‡½æ•°å°±æ˜¯è¿™ä¸ªæ¨¡å¼ä¸­çš„å·¥å‚æ–¹æ³•ï¼Œå®ƒæ ¹æ®å¤–éƒ¨ä¼ å…¥çš„é©±åŠ¨åç§°â€œç”Ÿäº§â€å‡ºä¸åŒç±»åˆ«çš„æ•°æ®åº“å®ä¾‹å¥æŸ„ã€‚

è¿™ç§â€œæ³¨å†Œæ¨¡å¼â€åœ¨æ ‡å‡†åº“çš„å…¶ä»–åŒ…ä¸­ä¹Ÿæœ‰å¹¿æ³›åº”ç”¨ï¼Œæ¯”å¦‚è¯´ï¼Œä½¿ç”¨æ ‡å‡†åº“imageåŒ…è·å–å„ç§æ ¼å¼å›¾ç‰‡çš„å®½å’Œé«˜ï¼š

```go
package main

import (
    "fmt"
    "image"
    _ "image/gif" // ä»¥ç©ºå¯¼å…¥æ–¹å¼æ³¨å…¥gifå›¾ç‰‡æ ¼å¼é©±åŠ¨
    _ "image/jpeg" // ä»¥ç©ºå¯¼å…¥æ–¹å¼æ³¨å…¥jpegå›¾ç‰‡æ ¼å¼é©±åŠ¨
    _ "image/png" // ä»¥ç©ºå¯¼å…¥æ–¹å¼æ³¨å…¥pngå›¾ç‰‡æ ¼å¼é©±åŠ¨
    "os"
)

func main() {
    // æ”¯æŒpng, jpeg, gif
    width, height, err := imageSize(os.Args[1]) // è·å–ä¼ å…¥çš„å›¾ç‰‡æ–‡ä»¶çš„å®½ä¸é«˜
    if err != nil {
        fmt.Println("get image size error:", err)
        return
    }
    fmt.Printf("image size: [%d, %d]\n", width, height)
}

func imageSize(imageFile string) (int, int, error) {
    f, _ := os.Open(imageFile) // æ‰“å¼€å›¾æ–‡æ–‡ä»¶
    defer f.Close()

    img, _, err := image.Decode(f) // å¯¹æ–‡ä»¶è¿›è¡Œè§£ç ï¼Œå¾—åˆ°å›¾ç‰‡å®ä¾‹
    if err != nil {
        return 0, 0, err
    }

    b := img.Bounds() // è¿”å›å›¾ç‰‡åŒºåŸŸ
    return b.Max.X, b.Max.Y, nil
}
```

ä¸Šé¢è¿™ä¸ªç¤ºä¾‹ç¨‹åºæ”¯æŒpngã€jpegã€gifä¸‰ç§æ ¼å¼çš„å›¾ç‰‡ï¼Œè€Œè¾¾æˆè¿™ä¸€ç›®æ ‡çš„åŸå› ï¼Œæ­£æ˜¯image/pngã€image/jpegå’Œimage/gifåŒ…éƒ½åœ¨å„è‡ªçš„initå‡½æ•°ä¸­ï¼Œå°†è‡ªå·±â€œæ³¨å†Œâ€åˆ°imageçš„æ”¯æŒæ ¼å¼åˆ—è¡¨ä¸­äº†ï¼š

```go
// $GOROOT/src/image/png/reader.go
func init() {
    image.RegisterFormat("png", pngHeader, Decode, DecodeConfig)
}

// $GOROOT/src/image/jpeg/reader.go
func init() {
    image.RegisterFormat("jpeg", "\xff\xd8", Decode, DecodeConfig)
}

// $GOROOT/src/image/gif/reader.go
func init() {
    image.RegisterFormat("gif", "GIF8?a", Decode, DecodeConfig)
}  
```



### æ€è€ƒé¢˜

> å½“initå‡½æ•°åœ¨æ£€æŸ¥åŒ…æ•°æ®åˆå§‹çŠ¶æ€æ—¶é‡åˆ°å¤±è´¥æˆ–é”™è¯¯çš„æƒ…å†µï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ

## 09 å³å­¦å³ç»ƒï¼šæ„å»ºä¸€ä¸ªWebæœåŠ¡å°±æ˜¯è¿™ä¹ˆç®€å•

### æœ€ç®€å•çš„HTTPæœåŠ¡

```go
package main

import "net/http"

func main() {
	http.HandleFunc("/", func(w http.ResponseWriter, r *http.Request) {
		w.Write([]byte("hello, world!"))
	})
	http.ListenAndServe(":8080", nil)
}
```

ListenAndServe

HandleFunc

ç¬¬äºŒä¸ªå‚æ•°rä»£è¡¨æ¥è‡ªå®¢æˆ·ç«¯çš„HTTPè¯·æ±‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°wåˆ™æ˜¯ç”¨æ¥æ“ä½œè¿”å›ç»™å®¢æˆ·ç«¯çš„åº”ç­”çš„ï¼ŒåŸºäºhttpåŒ…å®ç°çš„HTTPæœåŠ¡çš„å¤„ç†å‡½æ•°éƒ½è¦ç¬¦åˆè¿™ä¸€åŸå‹ã€‚

å°†è¯·æ±‚ä¸­çš„URIè·¯å¾„ä¸è®¾ç½®çš„æ¨¡å¼å­—ç¬¦ä¸²è¿›è¡Œ==æœ€é•¿å‰ç¼€åŒ¹é…==ï¼Œå¹¶æ‰§è¡ŒåŒ¹é…åˆ°çš„æ¨¡å¼å­—ç¬¦ä¸²æ‰€å¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚

### å›¾ä¹¦ç®¡ç†APIæœåŠ¡ â¤ï¸

![](images/image-20240703103915037.png)

#### é¡¹ç›®å»ºç«‹ä¸å¸ƒå±€è®¾è®¡

bookstore

æœåŠ¡å¤§ä½“æ‹†åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ï¼š

- ä¸€éƒ¨åˆ†æ˜¯HTTPæœåŠ¡å™¨ï¼Œç”¨æ¥å¯¹å¤–æä¾›APIæœåŠ¡ï¼›
- å¦ä¸€éƒ¨åˆ†æ˜¯å›¾ä¹¦æ•°æ®çš„å­˜å‚¨æ¨¡å—ï¼Œæ‰€æœ‰çš„å›¾ä¹¦æ•°æ®å‡å­˜å‚¨åœ¨è¿™é‡Œã€‚

Goé¡¹ç›®å¸ƒå±€æ ‡å‡†ï¼š

```
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ bookstore/         // æ”¾ç½®bookstore mainåŒ…æºç 
â”‚       â””â”€â”€ main.go
â”œâ”€â”€ go.mod                 // module bookstoreçš„go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ internal/              // å­˜æ”¾é¡¹ç›®å†…éƒ¨åŒ…çš„ç›®å½•
â”‚   â””â”€â”€ store/
â”‚       â””â”€â”€ memstore.go     
â”œâ”€â”€ server/                // HTTPæœåŠ¡å™¨æ¨¡å—
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ middleware.go
â”‚   â””â”€â”€ server.go          
â””â”€â”€ store/                 // å›¾ä¹¦æ•°æ®å­˜å‚¨æ¨¡å—
    â”œâ”€â”€ factory/
    â”‚   â””â”€â”€ factory.go
    â””â”€â”€ store.go
```

#### é¡¹ç›®mainåŒ…

![](images/image-20240703104236493.png)

```go
// cmd/bookstore/main.go
package main

import (
	_ "bookstore/internal/store"
	"bookstore/server"
	"bookstore/store/factory"
	"context"
	"log"
	"os"
	"os/signal"
	"syscall"
	"time"
)

func main() {
	s, err := factory.New("mem") // 1ï¸âƒ£åˆ›å»ºå›¾ä¹¦æ•°æ®å­˜å‚¨æ¨¡å—å®ä¾‹
	if err != nil {
		panic(err)
	}

	srv := server.NewBookStoreServer(":8080", s) // 2ï¸âƒ£åˆ›å»ºhttpæœåŠ¡å®ä¾‹

	errChan, err := srv.ListenAndServe() // è¿è¡ŒhttpæœåŠ¡
	if err != nil {
		log.Println("web server start failed: ", err)
		return
	}
	log.Println("web server start ok")

	// 3ï¸âƒ£é€šè¿‡ç›‘è§†ç³»ç»Ÿä¿¡å·å®ç°äº†httpæœåŠ¡å®ä¾‹çš„ä¼˜é›…é€€å‡º
	c := make(chan os.Signal, 1)
	signal.Notify(c, syscall.SIGINT, syscall.SIGTERM) // æ•è·ç³»ç»Ÿä¿¡å·SIGINTã€SIGTERM

	select { // ç›‘è§†æ¥è‡ªerrChanä»¥åŠcçš„äº‹ä»¶
	case err = <-errChan:
		log.Println("web server run failed:", err)
		return
	case <-c:
		log.Println("bookstore program is exiting...")
		ctx, cf := context.WithTimeout(context.Background(), time.Second)
		defer cf()
		err = srv.Shutdown(ctx) // ä¼˜é›…å…³é—­httpæœåŠ¡å®ä¾‹
	}

	if err != nil {
		log.Println("bookstore program exit error: ", err)
		return
	}
	log.Println("bookstore program exit ok")
}
```

> åœ¨Goä¸­ï¼ŒmainåŒ…æ˜¯æ•´ä¸ªç¨‹åºçš„å…¥å£ï¼Œè¿˜æ˜¯æ•´ä¸ªç¨‹åºä¸­==ä¸»è¦æ¨¡å—åˆå§‹åŒ–ä¸ç»„è£…çš„åœºæ‰€==ã€‚

ä¼˜é›…é€€å‡ºï¼ŒæŒ‡çš„å°±æ˜¯**ç¨‹åºæœ‰æœºä¼šç­‰å¾…å…¶ä»–çš„äº‹æƒ…å¤„ç†å®Œå†é€€å‡º**ã€‚æ¯”å¦‚**å°šæœªå®Œæˆçš„äº‹åŠ¡å¤„ç†ã€æ¸…ç†èµ„æºï¼ˆæ¯”å¦‚å…³é—­æ–‡ä»¶æè¿°ç¬¦ã€å…³é—­socketï¼‰ã€ä¿å­˜å¿…è¦ä¸­é—´çŠ¶æ€ã€å†…å­˜æ•°æ®æŒä¹…åŒ–è½ç›˜**ç­‰ç­‰ã€‚

httpæœåŠ¡å®ä¾‹å†…éƒ¨çš„é€€å‡ºæ¸…ç†å·¥ä½œï¼ŒåŒ…æ‹¬ï¼š**ç«‹å³å…³é—­æ‰€æœ‰listenerã€å…³é—­æ‰€æœ‰ç©ºé—²çš„è¿æ¥ã€ç­‰å¾…å¤„äºæ´»åŠ¨çŠ¶æ€çš„è¿æ¥å¤„ç†å®Œæ¯•**ç­‰ç­‰ã€‚



#### å›¾ä¹¦æ•°æ®å­˜å‚¨æ¨¡å—ï¼ˆstore)

ç”¨æ¥**å­˜å‚¨æ•´ä¸ªbookstoreçš„å›¾ä¹¦æ•°æ®**çš„ã€‚

å›¾ä¹¦æ•°æ®å­˜å‚¨æœ‰å¾ˆå¤šç§å®ç°æ–¹å¼ï¼Œæœ€ç®€å•çš„æ–¹å¼è«è¿‡äºåœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªmapï¼Œä»¥å›¾ä¹¦idä½œä¸ºkeyï¼Œæ¥ä¿å­˜å›¾ä¹¦ä¿¡æ¯ã€‚ç”Ÿäº§ç¯å¢ƒï¼Œéœ€è¦é€šè¿‡Nosqlæ•°æ®åº“æˆ–å…³ç³»å‹æ•°æ®åº“ã€‚

è€ƒè™‘åˆ°å¯¹å¤šç§å­˜å‚¨å®ç°æ–¹å¼çš„æ”¯æŒï¼Œå°†é’ˆå¯¹å›¾ä¹¦çš„æœ‰é™ç§å­˜å‚¨æ“ä½œï¼Œæ”¾ç½®åœ¨ä¸€ä¸ªæ¥å£ç±»å‹Storeä¸­ï¼š

```go
// store/store.go
 type Book struct {
     Id      string   `json:"id"`      // å›¾ä¹¦ISBN ID
     Name    string   `json:"name"`    // å›¾ä¹¦åç§°
     Authors []string `json:"authors"` // å›¾ä¹¦ä½œè€…
     Press   string   `json:"press"`   // å‡ºç‰ˆç¤¾
 }
 
 type Store interface {
     Create(*Book) error        // åˆ›å»ºä¸€ä¸ªæ–°å›¾ä¹¦æ¡ç›®
     Update(*Book) error        // æ›´æ–°æŸå›¾ä¹¦æ¡ç›®
     Get(string) (Book, error)  // è·å–æŸå›¾ä¹¦ä¿¡æ¯
     GetAll() ([]Book, error)   // è·å–æ‰€æœ‰å›¾ä¹¦ä¿¡æ¯
     Delete(string) error       // åˆ é™¤æŸå›¾ä¹¦æ¡ç›®
 }
```

ä¸€ä¸ªå¯¹åº”å›¾ä¹¦æ¡ç›®çš„æŠ½è±¡æ•°æ®ç±»å‹Bookï¼Œä»¥åŠé’ˆå¯¹Bookå­˜å–çš„æ¥å£ç±»å‹Storeã€‚è¿™æ ·ï¼Œå¯¹äºæƒ³è¦è¿›è¡Œå›¾ä¹¦æ•°æ®æ“ä½œçš„ä¸€æ–¹æ¥è¯´ï¼Œä»–åªéœ€è¦å¾—åˆ°ä¸€ä¸ªæ»¡è¶³Storeæ¥å£çš„å®ä¾‹ï¼Œå°±å¯ä»¥å®ç°å¯¹å›¾ä¹¦æ•°æ®çš„å­˜å‚¨æ“ä½œäº†ï¼Œä¸ç”¨å†å…³å¿ƒå›¾ä¹¦æ•°æ®ç©¶ç«Ÿé‡‡ç”¨äº†ä½•ç§å­˜å‚¨æ–¹å¼ã€‚è¿™å°±å®ç°äº†**å›¾ä¹¦å­˜å‚¨æ“ä½œä¸åº•å±‚å›¾ä¹¦æ•°æ®å­˜å‚¨æ–¹å¼çš„è§£è€¦**ã€‚è€Œä¸”ï¼Œè¿™ç§==é¢å‘æ¥å£ç¼–ç¨‹==ä¹Ÿæ˜¯Goç»„åˆè®¾è®¡å“²å­¦çš„ä¸€ä¸ªé‡è¦ä½“ç°ã€‚

> å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ»¡è¶³Storeæ¥å£çš„å®ä¾‹å‘¢ï¼Ÿ

å‚è€ƒã€Šè®¾è®¡æ¨¡å¼ã€‹æä¾›çš„å¤šç§åˆ›å»ºå‹æ¨¡å¼ï¼Œé€‰æ‹©ä¸€ç§Goé£æ ¼çš„å·¥å‚æ¨¡å¼ï¼ˆåˆ›å»ºå‹æ¨¡å¼çš„ä¸€ç§ï¼‰æ¥å®ç°æ»¡è¶³Storeæ¥å£å®ä¾‹çš„åˆ›å»ºã€‚`store/factory`åŒ…:

```go
// store/factory/factory.go
package factory

import (
	"bookstore/store"
	"fmt"
	"sync"
)

var (
	providersMu sync.RWMutex
	providers   = make(map[string]store.Store) // ä½¿ç”¨mapç±»å‹å¯¹å·¥å‚å¯ä»¥â€œç”Ÿäº§â€çš„ã€æ»¡è¶³Storeæ¥å£çš„å®ä¾‹ç±»å‹è¿›è¡Œç®¡ç†
)

// Register è®©å„ä¸ªå®ç°Storeæ¥å£çš„ç±»å‹å¯ä»¥æŠŠè‡ªå·±â€œæ³¨å†Œâ€åˆ°å·¥å‚ä¸­æ¥
func Register(name string, p store.Store) {
	providersMu.Lock()
	defer providersMu.Unlock()
	if p == nil {
		panic("store: Register provider is nil")
	}

	if _, dup := providers[name]; dup {
		panic("store: Register called twice for provider " + name)
	}
	providers[name] = p
}

// New ä¼ å…¥æœŸæœ›ä½¿ç”¨çš„å›¾ä¹¦å­˜å‚¨å®ç°çš„åç§°ï¼Œå¾—åˆ°å¯¹åº”çš„ç±»å‹å®ä¾‹
func New(providerName string) (store.Store, error) {
	providersMu.RLock()
	p, ok := providers[providerName]
	providersMu.RUnlock()
	if !ok {
		return nil, fmt.Errorf("store: unknown provider %s", providerName)
	}
	return p, nil
}
```



ä¸€ä¸ªåŸºäºå†…å­˜mapçš„Storeæ¥å£çš„å®ç°:

```go
// internal/store/memstore.go
package store

import (
	mystore "bookstore/store"
	factory "bookstore/store/factory"
	"sync"
)

func init() {
	factory.Register("mem", &MemStore{
		books: make(map[string]*mystore.Book),
	})
}

// MemStore æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜mapçš„Storeæ¥å£çš„å®ç°
type MemStore struct {
	sync.RWMutex
	books map[string]*mystore.Book
}

// ...å…·ä½“å®ç°æ–¹æ³•
```

initå‡½æ•°ä¸­è°ƒç”¨factoryåŒ…æä¾›çš„Registerå‡½æ•°ï¼ŒæŠŠè‡ªå·±çš„å®ä¾‹ä»¥â€œmemâ€çš„åç§°æ³¨å†Œåˆ°factoryä¸­çš„ã€‚è¿™æ ·åšæœ‰ä¸€ä¸ªå¥½å¤„ï¼Œä¾èµ–Storeæ¥å£è¿›è¡Œå›¾ä¹¦æ•°æ®ç®¡ç†çš„ä¸€æ–¹ï¼Œåªè¦å¯¼å…¥internal/storeè¿™ä¸ªåŒ…ï¼Œå°±å¯ä»¥è‡ªåŠ¨å®Œæˆæ³¨å†ŒåŠ¨ä½œäº†ã€‚

```go
import (
  ... ...
  _ "bookstore/internal/store" // internal/storeå°†è‡ªèº«æ³¨å†Œåˆ°factoryä¸­
)

func main() {
    s, err := factory.New("mem") // åˆ›å»ºåä¸º"mem"çš„å›¾ä¹¦æ•°æ®å­˜å‚¨æ¨¡å—å®ä¾‹
    if err != nil {
        panic(err)
    }
    ... ...
}   
```

#### HTTPæœåŠ¡æ¨¡å—ï¼ˆserverï¼‰

HTTPæœåŠ¡æ¨¡å—çš„èŒè´£æ˜¯**å¯¹å¤–æä¾›HTTP APIæœåŠ¡ï¼Œå¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„å„ç§è¯·æ±‚ï¼Œå¹¶é€šè¿‡Storeæ¥å£å®ä¾‹æ‰§è¡Œé’ˆå¯¹å›¾ä¹¦æ•°æ®çš„ç›¸å…³æ“ä½œ**ã€‚



#### ç¼–è¯‘ã€è¿è¡Œä¸éªŒè¯



```sh
$ curl -X POST -H "Content-Type:application/json" -d '{"id": "978-7-111-55842-2", "name": "The Go Programming Language", "authors":["Alan A.A.Donovan", "Brian W. Kergnighan"],"press": "Pearson Education"}' localhost:8080/book



$ curl -X GET -H "Content-Type:application/json" localhost:8080/book/978-7-111-55842-2
{"id":"978-7-111-55842-2","name":"The Go Programming Language","authors":["Alan A.A.Donovan","Brian W. Kergnighan"],"press":"Pearson Education"}
```





# åŸºç¡€ç¯‡ï¼šâ€œè„‘å‹¤â€å¤šç†è§£

## 10 å˜é‡å£°æ˜ï¼šé™æ€è¯­è¨€æœ‰åˆ«äºåŠ¨æ€è¯­è¨€çš„é‡è¦ç‰¹å¾



## 11 ä»£ç å—ä¸ä½œç”¨åŸŸï¼šå¦‚ä½•ä¿è¯å˜é‡ä¸ä¼šè¢«é®è”½ï¼Ÿ



## 12 åŸºæœ¬æ•°æ®ç±»å‹ï¼šGoåŸç”Ÿæ”¯æŒçš„æ•°å€¼ç±»å‹æœ‰å“ªäº›ï¼Ÿ



## 13 åŸºæœ¬æ•°æ®ç±»å‹ï¼šä¸ºä»€ä¹ˆGoè¦åŸç”Ÿæ”¯æŒå­—ç¬¦ä¸²ç±»å‹ï¼Ÿ



## 14 å¸¸é‡ï¼šGoåœ¨â€œå¸¸é‡â€è®¾è®¡ä¸Šçš„åˆ›æ–°æœ‰å“ªäº›ï¼Ÿ



## 15 åŒæ„å¤åˆç±»å‹ï¼šä»å®šé•¿æ•°ç»„åˆ°å˜é•¿åˆ‡ç‰‡



## 16 å¤åˆæ•°æ®ç±»å‹ï¼šåŸç”Ÿmapç±»å‹çš„å®ç°æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ





## 17 å¤åˆæ•°æ®ç±»å‹ï¼šç”¨ç»“æ„ä½“å»ºç«‹å¯¹çœŸå®ä¸–ç•Œçš„æŠ½è±¡



## 18 æ§åˆ¶ç»“æ„ï¼šifçš„â€œå¿«ä¹è·¯å¾„â€åŸåˆ™





## 19 æ§åˆ¶ç»“æ„ï¼šGoçš„forå¾ªç¯ï¼Œä»…æ­¤ä¸€ç§





## 20 æ§åˆ¶ç»“æ„ï¼šGoä¸­çš„switchè¯­å¥æœ‰å“ªäº›å˜åŒ–ï¼Ÿ



## 21 å‡½æ•°ï¼šè¯·å«æˆ‘â€œä¸€ç­‰å…¬æ°‘â€





## 22 å‡½æ•°ï¼šæ€ä¹ˆç»“åˆå¤šè¿”å›å€¼è¿›è¡Œé”™è¯¯å¤„ç†ï¼Ÿ

 



## 23 å‡½æ•°ï¼šæ€ä¹ˆè®©å‡½æ•°æ›´ç®€æ´å¥å£®ï¼Ÿ





## 24 æ–¹æ³•ï¼šç†è§£â€œæ–¹æ³•â€çš„æœ¬è´¨



## 25 æ–¹æ³•ï¼šæ–¹æ³•é›†åˆä¸å¦‚ä½•é€‰æ‹©receiverç±»å‹ï¼Ÿ



## 26 æ–¹æ³•ï¼šå¦‚ä½•ç”¨ç±»å‹åµŒå…¥æ¨¡æ‹Ÿå®ç°â€œç»§æ‰¿â€ï¼Ÿ



## 27 å³å­¦å³ç»ƒï¼šè·Ÿè¸ªå‡½æ•°è°ƒç”¨é“¾ï¼Œç†è§£ä»£ç æ›´ç›´è§‚



# æ ¸å¿ƒç¯‡ï¼šâ€œè„‘å‹¤+â€æ´å½»æ ¸å¿ƒ

## 28ï½œæ¥å£ï¼šæ¥å£å³å¥‘çº¦





## 29 æ¥å£ï¼šä¸ºä»€ä¹ˆnilæ¥å£ä¸ç­‰äºnilï¼Ÿ





## 30 æ¥å£ï¼šGoä¸­æœ€å¼ºå¤§çš„é­”æ³•



## 31 å¹¶å‘ï¼šGoçš„å¹¶å‘æ–¹æ¡ˆå®ç°æ–¹æ¡ˆæ˜¯æ€æ ·çš„ï¼Ÿ



## 32 å¹¶å‘ï¼šèŠèŠGoroutineè°ƒåº¦å™¨çš„åŸç†



## 33 å¹¶å‘ï¼šå°channelä¸­è•´å«å¤§æ™ºæ…§



## 34 å¹¶å‘ï¼šå¦‚ä½•ä½¿ç”¨å…±äº«å˜é‡ï¼Ÿ



## 35 å³å­¦å³ç»ƒï¼šå¦‚ä½•å®ç°ä¸€ä¸ªè½»é‡çº§çº¿ç¨‹æ± ï¼Ÿ



# å®æˆ˜ç¯‡ï¼šæ‰“é€šâ€œæœ€åä¸€å…¬é‡Œâ€



# æ³›å‹ç¯‡



